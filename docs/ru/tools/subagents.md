---
summary: "–°—É–±–∞–≥–µ–Ω—Ç—ã: –∑–∞–ø—É—Å–∫ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–Ω—ã—Ö –ø—Ä–æ–≥–æ–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—ä—è–≤–ª—è—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ –≤ —á–∞—Ç –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞"
read_when:
  - –í–∞–º –Ω—É–∂–Ω–∞ —Ñ–æ–Ω–æ–≤–∞—è/–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ –∞–≥–µ–Ω—Ç–∞
  - –í—ã –∏–∑–º–µ–Ω—è–µ—Ç–µ sessions_spawn –∏–ª–∏ –ø–æ–ª–∏—Ç–∏–∫—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å—É–±–∞–≥–µ–Ω—Ç–æ–≤
title: "–°—É–±–∞–≥–µ–Ω—Ç—ã"
---

# –°—É–±–∞–≥–µ–Ω—Ç—ã

–ü–æ–¥–∞–≥–µ–Ω—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∏–∞–ª–æ–≥. –ö–æ–≥–¥–∞ –≤—ã —Å–æ–∑–¥–∞–µ—Ç–µ –ø–æ–¥–∞–≥–µ–Ω—Ç–∞, –æ–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏, –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É –∏ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–±—ä—è–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ —á–∞—Ç.

**–°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

- –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–µ–º—É, –ø–æ–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∞–≥–µ–Ω—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
- –ó–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (–≤–µ–±-—Å–∫—Ä–µ–π–ø–∏–Ω–≥, –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤)
- –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∞–≥–µ–Ω—Ç–∞–º –≤ –º–Ω–æ–≥–æ–∞–≥–µ–Ω—Ç–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥–∞–≥–µ–Ω—Ç–æ–≤ ‚Äî –ø–æ–ø—Ä–æ—Å–∏—Ç—å –∞–≥–µ–Ω—Ç–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–±—Ä–∞–∑–æ–º:

> "–°–æ–∑–¥–∞–π –ø–æ–¥–∞–≥–µ–Ω—Ç–∞ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø—Ä–∏–º–µ—á–∞–Ω–∏–π –∫ –≤—ã–ø—É—Å–∫—É Node.js"

–ê–≥–µ–Ω—Ç –∑–∞ –∫—É–ª–∏—Å–∞–º–∏ –≤—ã–∑–æ–≤–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `sessions_spawn`. –ö–æ–≥–¥–∞ –ø–æ–¥–∞–≥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∏—Ç —Ä–∞–±–æ—Ç—É, –æ–Ω –æ–±—ä—è–≤–∏—Ç —Å–≤–æ–∏ –≤—ã–≤–æ–¥—ã –æ–±—Ä–∞—Ç–Ω–æ –≤ –≤–∞—à —á–∞—Ç.

–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

> "–°–æ–∑–¥–∞–π –ø–æ–¥–∞–≥–µ–Ω—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ª–æ–≥–æ–≤ –∑–∞ —Å–µ–≥–æ–¥–Ω—è.
> –ò—Å–ø–æ–ª—å–∑—É–π gpt-5.2 –∏ –∑–∞–¥–∞–π —Ç–∞–π–º-–∞—É—Ç 5 –º–∏–Ω—É—Ç." –û—Å–Ω–æ–≤–Ω–æ–π –∞–≥–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `sessions_spawn` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–¥–∞—á–∏.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

<Steps>
  <Step title="Main agent spawns">
    –í—ã–∑–æ–≤ **–Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∞–≥–µ–Ω—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç `{ status: "accepted", runId, childSessionKey }`. 
    –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è (`agent:
    :subagent:
    `) –≤ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ `subagent`.
  
  </Step>
  <Step title="Sub-agent runs in the background">–ö–æ–≥–¥–∞ –ø–æ–¥–∞–≥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É, –æ–Ω –æ–±—ä—è–≤–ª—è–µ—Ç —Å–≤–æ–∏ –≤—ã–≤–æ–¥—ã –æ–±—Ä–∞—Ç–Ω–æ –≤ —á–∞—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–µ–π —Å—Ç–æ—Ä–æ–Ω—ã.<agentId>–û—Å–Ω–æ–≤–Ω–æ–π –∞–≥–µ–Ω—Ç –ø—É–±–ª–∏–∫—É–µ—Ç —Å–≤–æ–¥–∫—É –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ.<uuid>–°–µ—Å—Å–∏—è –ø–æ–¥–∞–≥–µ–Ω—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ 60 –º–∏–Ω—É—Ç (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è).</Step>
  <Step title="Result is announced">
    –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è. –£ –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–∞–≥–µ–Ω—Ç–∞ –µ—Å—Ç—å **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π** –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤.
  </Step>
  <Step title="Session is archived">
    –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ–ª–µ–µ –¥–µ—à–µ–≤—É—é –º–æ–¥–µ–ª—å –¥–ª—è –ø–æ–¥–∞–≥–µ–Ω—Ç–æ–≤, —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã ‚Äî —Å–º. [Setting a Default Model](#setting-a-default-model) –Ω–∏–∂–µ. –ü–æ–¥–∞–≥–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª –±–µ–∑ –∫–∞–∫–æ–π-–ª–∏–±–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
  </Step>
</Steps>

<Tip>
–ú–æ–¥–µ–ª—å: –æ–±—ã—á–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ —Ü–µ–ª–µ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω–æ `subagents.model`) –ú—ã—à–ª–µ–Ω–∏–µ: –±–µ–∑ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–∞–≥–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω–æ `subagents.thinking`)
</Tip>

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ú–∞–∫—Å. –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö: 8 –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

- –ê–≤—Ç–æ–∞—Ä—Ö–∏–≤–∞—Ü–∏—è: —á–µ—Ä–µ–∑ 60 –º–∏–Ω—É—Ç
- –ó–∞–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –¥–µ—à–µ–≤—É—é –º–æ–¥–µ–ª—å –¥–ª—è –ø–æ–¥–∞–≥–µ–Ω—Ç–æ–≤, —á—Ç–æ–±—ã —ç–∫–æ–Ω–æ–º–∏—Ç—å –Ω–∞ —Ç–æ–∫–µ–Ω–∞—Ö:
- {
  agents: {
  defaults: {
  subagents: {
  model: "minimax/MiniMax-M2.1",
  },
  },
  },
  }

### –ó–∞–¥–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è –º—ã—à–ª–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

Use a cheaper model for sub-agents to save on token costs:

```json5
{
  agents: {
    defaults: {
      subagents: {
        model: "minimax/MiniMax-M2.1",
      },
    },
  },
}
```

### Setting a Default Thinking Level

```json5
{
  agents: {
    defaults: {
      subagents: {
        thinking: "low",
      },
    },
  },
}
```

### Per-Agent Overrides

In a multi-agent setup, you can set sub-agent defaults per agent:

```json5
{
  agents: {
    list: [
      {
        id: "researcher",
        subagents: {
          model: "anthropic/claude-sonnet-4",
        },
      },
      {
        id: "assistant",
        subagents: {
          model: "minimax/MiniMax-M2.1",
        },
      },
    ],
  },
}
```

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è

Control how many sub-agents can run at the same time:

```json5
{
  agents: {
    defaults: {
      subagents: {
        maxConcurrent: 4, // default: 8
      },
    },
  },
}
```

Sub-agents use a dedicated queue lane (`subagent`) separate from the main agent queue, so sub-agent runs don't block inbound replies.

### Auto-Archive

Sub-agent sessions are automatically archived after a configurable period:

```json5
{
  agents: {
    defaults: {
      subagents: {
        archiveAfterMinutes: 120, // default: 60
      },
    },
  },
}
```

<Note>
Archive renames the transcript to `*.deleted.<timestamp>` (same folder) ‚Äî transcripts are preserved, not deleted. Auto-archive timers are best-effort; pending timers are lost if the gateway restarts.
</Note>

## The `sessions_spawn` Tool

This is the tool the agent calls to create sub-agents.

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

| Parameter           | –¢–∏–ø                      | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é                 | Description                                                                                       |
| ------------------- | ------------------------ | ------------------------------------- | ------------------------------------------------------------------------------------------------- |
| `task`              | string                   | _(required)_       | What the sub-agent should do                                                                      |
| `–º–µ—Ç–∫–∞`             | string                   | ‚Äî                                     | Short label for identification                                                                    |
| `agentId`           | string                   | _(caller's agent)_ | Spawn under a different agent id (must be allowed)                             |
| `–º–æ–¥–µ–ª—å`            | string                   | _(optional)_       | Override the model for this sub-agent                                                             |
| `thinking`          | string                   | _(optional)_       | Override thinking level (`off`, `low`, `medium`, `high`, etc.) |
| `runTimeoutSeconds` | number                   | `0` (no limit)     | Abort the sub-agent after N seconds                                                               |
| `–æ—á–∏—Å—Ç–∫–∞`           | `"delete"` \\| `"keep"` | `"keep"`                              | `"delete"` archives immediately after announce                                                    |

### Model Resolution Order

The sub-agent model is resolved in this order (first match wins):

1. Explicit `model` parameter in the `sessions_spawn` call
2. Per-agent config: `agents.list[].subagents.model`
3. Global default: `agents.defaults.subagents.model`
4. Target agent‚Äôs normal model resolution for that new session

Thinking level is resolved in this order:

1. Explicit `thinking` parameter in the `sessions_spawn` call
2. Per-agent config: `agents.list[].subagents.thinking`
3. Global default: `agents.defaults.subagents.thinking`
4. Otherwise no sub-agent-specific thinking override is applied

<Note>
Invalid model values are silently skipped ‚Äî the sub-agent runs on the next valid default with a warning in the tool result.
</Note>

### Cross-Agent Spawning

By default, sub-agents can only spawn under their own agent id. To allow an agent to spawn sub-agents under other agent ids:

```json5
{
  agents: {
    list: [
      {
        id: "orchestrator",
        subagents: {
          allowAgents: ["researcher", "coder"], // or ["*"] to allow any
        },
      },
    ],
  },
}
```

<Tip>
Use the `agents_list` tool to discover which agent ids are currently allowed for `sessions_spawn`.
</Tip>

## Managing Sub-Agents (`/subagents`)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ—à-–∫–æ–º–∞–Ω–¥—É `/subagents` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø—É—Å–∫–∞–º–∏ —Å—É–±–∞–≥–µ–Ω—Ç–æ–≤ –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏:

| –ö–æ–º–∞–Ω–¥–∞                                    | Description                                                       |
| ------------------------------------------ | ----------------------------------------------------------------- |
| `/subagents list`                          | List all sub-agent runs (active and completed) |
| `/subagents stop <id\\|#\\|all>`         | Stop a running sub-agent                                          |
| `/subagents log <id\\|#> [limit] [tools]` | View sub-agent transcript                                         |
| `/subagents info <id\\|#>`                | Show detailed run metadata                                        |
| `/subagents send <id\\|#> <message>`      | Send a message to a running sub-agent                             |

You can reference sub-agents by list index (`1`, `2`), run id prefix, full session key, or `last`.

<AccordionGroup>
  <Accordion title="Example: list and stop a sub-agent">
    ```
    /subagents list
    ```

    ````
    ```
    üß≠ Subagents (current session)
    Active: 1 ¬∑ Done: 2
    1) ‚úÖ ¬∑ research logs ¬∑ 2m31s ¬∑ run a1b2c3d4 ¬∑ agent:main:subagent:...
    2) ‚úÖ ¬∑ check deps ¬∑ 45s ¬∑ run e5f6g7h8 ¬∑ agent:main:subagent:...
    3) üîÑ ¬∑ deploy staging ¬∑ 1m12s ¬∑ run i9j0k1l2 ¬∑ agent:main:subagent:...
    ```
    
    ```
    /subagents stop 3
    ```
    
    ```
    ‚öôÔ∏è Stop requested for deploy staging.
    ```
    ````

  </Accordion>
  <Accordion title="Example: inspect a sub-agent">
    ```
    /subagents info 1
    ```

    ````
    ```
    ‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—É–±–∞–≥–µ–Ω—Ç–µ
    –°—Ç–∞—Ç—É—Å: ‚úÖ
    –ú–µ—Ç–∫–∞: –∂—É—Ä–Ω–∞–ª—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π
    –ó–∞–¥–∞—á–∞: –ò–∑—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∂—É—Ä–Ω–∞–ª—ã –æ—à–∏–±–æ–∫ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –æ–±–æ–±—â–∏—Ç—å –≤—ã–≤–æ–¥—ã
    –ó–∞–ø—É—Å–∫: a1b2c3d4-...
    –°–µ—Å—Å–∏—è: agent:main:subagent:...
    –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 2m31s
    –û—á–∏—Å—Ç–∫–∞: keep
    –†–µ–∑—É–ª—å—Ç–∞—Ç: ok
    ```
    ````

  </Accordion>
  <Accordion title="Example: view sub-agent log">
    ```
    /subagents log 1 10
    ```

    ````
    Shows the last 10 messages from the sub-agent's transcript. Add `tools` to include tool call messages:
    
    ```
    /subagents log 1 10 tools
    ```
    ````

  </Accordion>
  <Accordion title="Example: send a follow-up message">
    ```
    /subagents send 3 "Also check the staging environment"
    ```

    ```
    Sends a message into the running sub-agent's session and waits up to 30 seconds for a reply.
    ```

  </Accordion>
</AccordionGroup>

## Announce (How Results Come Back)

When a sub-agent finishes, it goes through an **announce** step:

1. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç —Å—É–±–∞–≥–µ–Ω—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
2. A summary message is sent to the main agent's session with the result, status, and stats
3. The main agent posts a natural-language summary to your chat

–û—Ç–≤–µ—Ç—ã –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é —Ç—Ä–µ–¥–æ–≤/—Ç–µ–º, –≥–¥–µ —ç—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ (—Ç—Ä–µ–¥—ã Slack, —Ç–µ–º—ã Telegram, —Ç—Ä–µ–¥—ã Matrix).

### Announce Stats

Each announce includes a stats line with:

- Runtime duration
- –†–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤ (–≤—Ö–æ–¥/–≤—ã—Ö–æ–¥/–≤—Å–µ–≥–æ)
- Estimated cost (when model pricing is configured via `models.providers.*.models[].cost`)
- Session key, session id, and transcript path

### Announce Status

The announce message includes a status derived from the runtime outcome (not from model output):

- **successful completion** (`ok`) ‚Äî task completed normally
- **error** ‚Äî task failed (error details in notes)
- **timeout** ‚Äî task exceeded `runTimeoutSeconds`
- **unknown** ‚Äî status could not be determined

<Tip>
If no user-facing announcement is needed, the main-agent summarize step can return `NO_REPLY` and nothing is posted.
This is different from `ANNOUNCE_SKIP`, which is used in agent-to-agent announce flow (`sessions_send`).
</Tip>

## Tool Policy

By default, sub-agents get **all tools except** a set of denied tools that are unsafe or unnecessary for background tasks:

<AccordionGroup>
  <Accordion title="Default denied tools">
    | Denied tool | Reason |
    |-------------|--------|
    | `sessions_list` | Session management ‚Äî main agent orchestrates |
    | `sessions_history` | Session management ‚Äî main agent orchestrates |
    | `sessions_send` | Session management ‚Äî main agent orchestrates |
    | `sessions_spawn` | No nested fan-out (sub-agents cannot spawn sub-agents) |
    | `gateway` | System admin ‚Äî dangerous from sub-agent |
    | `agents_list` | System admin |
    | `whatsapp_login` | Interactive setup ‚Äî not a task |
    | `session_status` | Status/scheduling ‚Äî main agent coordinates |
    | `cron` | Status/scheduling ‚Äî main agent coordinates |
    | `memory_search` | Pass relevant info in spawn prompt instead |
    | `memory_get` | Pass relevant info in spawn prompt instead |
  </Accordion>
</AccordionGroup>

### Customizing Sub-Agent Tools

You can further restrict sub-agent tools:

```json5
{
  tools: {
    subagents: {
      tools: {
        // deny always wins over allow
        deny: ["browser", "firecrawl"],
      },
    },
  },
}
```

To restrict sub-agents to **only** specific tools:

```json5
{
  tools: {
    subagents: {
      tools: {
        allow: ["read", "exec", "process", "write", "edit", "apply_patch"],
        // deny still wins if set
      },
    },
  },
}
```

<Note>
Custom deny entries are **added to** the default deny list. If `allow` is set, only those tools are available (the default deny list still applies on top).
</Note>

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—É–±–∞–≥–µ–Ω—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è **id –∞–≥–µ–Ω—Ç–∞**, –∞ –Ω–µ —Ç–∏–ø–æ–º —Å–µ—Å—Å–∏–∏:

- The auth store is loaded from the target agent's `agentDir`
- The main agent's auth profiles are merged in as a **fallback** (agent profiles win on conflicts)
- The merge is additive ‚Äî main profiles are always available as fallbacks

<Note>
Fully isolated auth per sub-agent is not currently supported.
</Note>

## Context and System Prompt

Sub-agents receive a reduced system prompt compared to the main agent:

- **Included:** Tooling, Workspace, Runtime sections, plus `AGENTS.md` and `TOOLS.md`
- **Not included:** `SOUL.md`, `IDENTITY.md`, `USER.md`, `HEARTBEAT.md`, `BOOTSTRAP.md`

–°—É–±–∞–≥–µ–Ω—Ç —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω—Å—Ç—Ä—É–∫—Ç–∏—Ä—É–µ—Ç –µ–≥–æ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–Ω—ã–º –Ω–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ, –≤—ã–ø–æ–ª–Ω–∏—Ç—å –µ–µ –∏ –Ω–µ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∞–≥–µ–Ω—Ç.

## Stopping Sub-Agents

| Method                 | Effect                                                                    |
| ---------------------- | ------------------------------------------------------------------------- |
| `/stop` in the chat    | Aborts the main session **and** all active sub-agent runs spawned from it |
| `/subagents stop <id>` | Stops a specific sub-agent without affecting the main session             |
| `runTimeoutSeconds`    | Automatically aborts the sub-agent run after the specified time           |

<Note>
`runTimeoutSeconds` does **not** auto-archive the session. The session remains until the normal archive timer fires.
</Note>

## –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

<Accordion title="Complete sub-agent configuration">
```json5
{
  agents: {
    defaults: {
      model: { primary: "anthropic/claude-sonnet-4" },
      subagents: {
        model: "minimax/MiniMax-M2.1",
        thinking: "low",
        maxConcurrent: 4,
        archiveAfterMinutes: 30,
      },
    },
    list: [
      {
        id: "main",
        default: true,
        name: "Personal Assistant",
      },
      {
        id: "ops",
        name: "Ops Agent",
        subagents: {
          model: "anthropic/claude-sonnet-4",
          allowAgents: ["main"], // ops can spawn sub-agents under "main"
        },
      },
    ],
  },
  tools: {
    subagents: {
      tools: {
        deny: ["browser"], // sub-agents can't use the browser
      },
    },
  },
}
```
</Accordion>

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

<Warning>
- **Best-effort announce:** If the gateway restarts, pending announce work is lost.
- **No nested spawning:** Sub-agents cannot spawn their own sub-agents.
- **Shared resources:** Sub-agents share the gateway process; use `maxConcurrent` as a safety valve.
- **Auto-archive is best-effort:** Pending archive timers are lost on gateway restart.
</Warning>

## See Also

- [Session Tools](/concepts/session-tool) ‚Äî details on `sessions_spawn` and other session tools
- [Multi-Agent Sandbox and Tools](/tools/multi-agent-sandbox-tools) ‚Äî per-agent tool restrictions and sandboxing
- [Configuration](/gateway/configuration) ‚Äî `agents.defaults.subagents` reference
- [Queue](/concepts/queue) ‚Äî how the `subagent` lane works
