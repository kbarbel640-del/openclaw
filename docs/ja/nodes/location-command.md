---
summary: "ノード向けの位置情報コマンド（location.get）、権限モード、およびバックグラウンド時の挙動"
read_when:
  - 位置情報ノードのサポートや権限 UI を追加する場合
  - バックグラウンド位置情報 + プッシュのフローを設計する場合
title: "位置情報コマンド"
x-i18n:
  source_path: nodes/location-command.md
  source_hash: 23124096256384d2
  provider: openai
  model: gpt-5.2-chat-latest
  workflow: v1
  generated_at: 2026-02-08T06:34:17Z
---

# 位置情報コマンド（ノード）

## TL;DR

- `location.get` はノードコマンドです（`node.invoke` 経由）。
- 既定ではオフです。
- 設定はセレクターを使用します：オフ / 使用中のみ / 常に。
- 個別トグル：正確な位置情報。

## なぜスイッチではなくセレクターなのか

OS の権限は多段階です。アプリ内ではセレクターを公開できますが、実際の許可は OS が決定します。

- iOS / macOS：ユーザーはシステムのプロンプトや設定で **使用中のみ** または **常に** を選択できます。アプリは昇格を要求できますが、OS により設定アプリでの操作が必要な場合があります。
- Android：バックグラウンド位置情報は別の権限です。Android 10 以降では、設定フローが必要になることが多くあります。
- 正確な位置情報は別の許可です（iOS 14+ の「正確な位置情報」、Android の「高精度（fine）」と「概算（coarse）」）。

UI のセレクターは要求するモードを決定し、実際の許可は OS 設定に存在します。

## 設定モデル

ノードデバイスごと：

- `location.enabledMode`：`off | whileUsing | always`
- `location.preciseEnabled`：bool

UI の挙動：

- `whileUsing` を選択すると、フォアグラウンド権限を要求します。
- `always` を選択すると、まず `whileUsing` を確認し、その後バックグラウンド権限を要求します（必要に応じてユーザーを設定へ誘導）。
- OS が要求したレベルを拒否した場合、付与されている中で最も高いレベルに戻し、ステータスを表示します。

## 権限マッピング（node.permissions）

任意。macOS ノードは権限マップを介して `location` を報告します。iOS / Android では省略される場合があります。

## コマンド：`location.get`

`node.invoke` 経由で呼び出されます。

パラメータ（推奨）：

```json
{
  "timeoutMs": 10000,
  "maxAgeMs": 15000,
  "desiredAccuracy": "coarse|balanced|precise"
}
```

レスポンスペイロード：

```json
{
  "lat": 48.20849,
  "lon": 16.37208,
  "accuracyMeters": 12.5,
  "altitudeMeters": 182.0,
  "speedMps": 0.0,
  "headingDeg": 270.0,
  "timestamp": "2026-01-03T12:34:56.000Z",
  "isPrecise": true,
  "source": "gps|wifi|cell|unknown"
}
```

エラー（安定コード）：

- `LOCATION_DISABLED`：セレクターがオフです。
- `LOCATION_PERMISSION_REQUIRED`：要求されたモードに必要な権限がありません。
- `LOCATION_BACKGROUND_UNAVAILABLE`：アプリがバックグラウンドですが、「使用中のみ」しか許可されていません。
- `LOCATION_TIMEOUT`：時間内に位置を取得できませんでした。
- `LOCATION_UNAVAILABLE`：システム障害 / プロバイダーなし。

## バックグラウンド時の挙動（将来）

目標：ノードがバックグラウンドでもモデルが位置情報を要求できるようにします。ただし、以下を満たす場合に限ります。

- ユーザーが **常に** を選択している。
- OS がバックグラウンド位置情報を許可している。
- アプリが位置情報のためにバックグラウンド実行を許可されている（iOS のバックグラウンドモード / Android のフォアグラウンドサービスまたは特別な許可）。

プッシュ起動フロー（将来）：

1. Gateway（ゲートウェイ）がノードへプッシュを送信します（サイレントプッシュまたは FCM データ）。
2. ノードが短時間起動し、デバイスから位置情報を要求します。
3. ノードがペイロードを Gateway（ゲートウェイ）へ転送します。

注意：

- iOS：常に許可 + バックグラウンド位置情報モードが必要です。サイレントプッシュはスロットリングされる場合があり、断続的な失敗が想定されます。
- Android：バックグラウンド位置情報にはフォアグラウンドサービスが必要な場合があります。そうでない場合、拒否されることが想定されます。

## モデル / ツール連携

- ツールのサーフェス：`nodes` ツールが `location_get` アクションを追加します（ノード必須）。
- CLI：`openclaw nodes location get --node <id>`。
- エージェント向けガイドライン：ユーザーが位置情報を有効化し、範囲を理解している場合にのみ呼び出してください。

## UX コピー（提案）

- オフ：「位置情報の共有は無効です。」
- 使用中のみ：「OpenClaw が開いているときのみ。」
- 常に：「バックグラウンドでの位置情報を許可します。システム権限が必要です。」
- 正確：「正確な GPS 位置情報を使用します。オフにすると概算の位置情報を共有します。」
