---
summary: "mac アプリにおける Voice wake と push-to-talk の各モードおよびルーティングの詳細"
read_when:
  - Voice wake または PTT の経路に取り組むとき
title: "Voice Wake"
x-i18n:
  source_path: platforms/mac/voicewake.md
  source_hash: f6440bb89f349ba5
  provider: openai
  model: gpt-5.2-chat-latest
  workflow: v1
  generated_at: 2026-02-08T06:34:36Z
---

# Voice Wake & Push-to-Talk

## モード

- **ウェイクワードモード**（デフォルト）: 常時オンの音声認識がトリガートークン（`swabbleTriggerWords`）を待機します。一致するとキャプチャを開始し、部分テキスト付きのオーバーレイを表示し、無音後に自動送信します。
- **Push-to-talk（右 Option 長押し）**: 右 Option キーを押し続けると、トリガー不要で即時にキャプチャします。押下中はオーバーレイが表示され、離すと短い遅延の後に確定して転送されるため、テキストを微調整できます。

## 実行時の挙動（ウェイクワード）

- 音声認識は `VoiceWakeRuntime` に常駐します。
- トリガーは、ウェイクワードと次の単語の間に **意味のあるポーズ**（約 0.55 秒の間隔）がある場合にのみ発火します。コマンドが始まる前でも、そのポーズ時点でオーバーレイ／チャイムが開始されることがあります。
- 無音ウィンドウ: 発話が続いている場合は 2.0 秒、トリガーのみが聞こえた場合は 5.0 秒です。
- 強制停止: 暴走セッション防止のため 120 秒です。
- セッション間のデバウンス: 350 ms です。
- オーバーレイは、確定／揮発の配色を用いて `VoiceWakeOverlayController` 経由で制御されます。
- 送信後、認識はクリーンに再起動し、次のトリガーを待機します。

## ライフサイクルの不変条件

- Voice Wake が有効で権限が付与されている場合、ウェイクワード認識は（明示的な push-to-talk キャプチャ中を除き）常にリッスンしている必要があります。
- オーバーレイの表示状態（X ボタンによる手動クローズを含む）は、認識の再開を妨げてはなりません。

## オーバーレイが貼り付く失敗モード（以前）

以前は、オーバーレイが表示されたまま固まり、手動で閉じた場合、実行時の再起動試行がオーバーレイ表示によりブロックされ、その後の再起動がスケジュールされないため、Voice Wake が「停止した」ように見えることがありました。

強化対応:

- ウェイク実行時の再起動は、オーバーレイの表示状態によってブロックされなくなりました。
- オーバーレイのクローズ完了により、`VoiceSessionCoordinator` を介して `VoiceWakeRuntime.refresh(...)` がトリガーされ、手動の X クローズでも必ずリッスンが再開されます。

## Push-to-talk の詳細

- ホットキー検出は、**右 Option**（`keyCode 61` + `.option`）向けのグローバル `.flagsChanged` モニターを使用します。イベントは監視のみで、横取りはしません。
- キャプチャパイプラインは `VoicePushToTalk` にあり、音声認識を即時開始し、部分結果をオーバーレイへストリーミングし、解放時に `VoiceWakeForwarder` を呼び出します。
- Push-to-talk 開始時は、音声タップの競合を避けるためウェイクワード実行時を一時停止し、解放後に自動再起動します。
- 権限: マイク + 音声認識が必要です。イベントの検出にはアクセシビリティ／入力監視の承認が必要です。
- 外部キーボード: 一部は右 Option を想定どおり公開しない場合があります。ユーザーから取りこぼしの報告があれば、代替ショートカットを提供してください。

## ユーザー向け設定

- **Voice Wake** トグル: ウェイクワード実行時を有効化します。
- **Cmd+Fn を押し続けて話す**: push-to-talk モニターを有効化します。macOS < 26 では無効です。
- 言語／マイクのピッカー、ライブレベルメーター、トリガーワード表、テスター（ローカルのみ；転送しません）。
- マイクピッカーは、デバイス切断時も直前の選択を保持し、切断中のヒントを表示し、復帰まで一時的にシステムデフォルトへフォールバックします。
- **サウンド**: トリガー検出時と送信時にチャイムを鳴らします。デフォルトは macOS の「Glass」システムサウンドです。各イベントごとに `NSSound` で読み込み可能な任意のファイル（例: MP3／WAV／AIFF）を選択するか、**サウンドなし**を選べます。

## 転送の挙動

- Voice Wake が有効な場合、文字起こしはアクティブな gateway／エージェントへ転送されます（mac アプリの他機能と同じローカル／リモートモード）。
- 返信は **直近で使用したメインプロバイダー**（WhatsApp／Telegram／Discord／WebChat）へ配信されます。配信に失敗した場合でも、エラーはログに記録され、WebChat／セッションログから実行内容を確認できます。

## 転送ペイロード

- `VoiceWakeForwarder.prefixedTranscript(_:)` は、送信前にマシンヒントを先頭に付与します。ウェイクワードと push-to-talk の両経路で共有されます。

## クイック確認

- Push-to-talk をオンにし、Cmd+Fn を押し続けて話し、解放します: オーバーレイに部分結果が表示され、その後送信されるはずです。
- 押下中は、メニューバーの耳アイコンが拡大されたままになります（`triggerVoiceEars(ttl:nil)` を使用）。解放後に元に戻ります。
