---
summary: "昇格 exec モードと /elevated ディレクティブ"
read_when:
  - 昇格モードのデフォルト、許可リスト、またはスラッシュコマンドの挙動を調整する場合
title: "昇格モード"
x-i18n:
  source_path: tools/elevated.md
  source_hash: 83767a0160930402
  provider: openai
  model: gpt-5.2-pro
  workflow: v1
  generated_at: 2026-02-06T05:11:51Z
---

# 昇格モード（/elevated ディレクティブ）

## それが行うこと

- `/elevated on` は Gateway（ゲートウェイ）ホスト上で実行され、exec 承認を維持します（`/elevated ask` と同じ）。
- `/elevated full` は Gateway（ゲートウェイ）ホスト上で実行され、かつ exec を自動承認します（exec 承認をスキップします）。
- `/elevated ask` は Gateway（ゲートウェイ）ホスト上で実行されますが、exec 承認は維持します（`/elevated on` と同じ）。
- `on`/`ask` は `exec.security=full` を強制**しません**。設定されたセキュリティ/確認ポリシーは引き続き適用されます。
- エージェントが **サンドボックス化された** 場合にのみ挙動が変わります（それ以外の場合、exec はすでにホスト上で実行されます）。
- ディレクティブ形式: `/elevated on|off|ask|full`、`/elev on|off|ask|full`。
- `on|off|ask|full` のみが受け付けられます。それ以外はヒントを返し、状態は変更しません。

## 制御するもの（そして制御しないもの）

- **可用性ゲート**: `tools.elevated` がグローバルのベースラインです。`agents.list[].tools.elevated` はエージェント単位で昇格をさらに制限できます（両方が許可する必要があります）。
- **セッション単位の状態**: `/elevated on|off|ask|full` は現在のセッションキーの昇格レベルを設定します。
- **インラインディレクティブ**: メッセージ内の `/elevated on|ask|full` は、そのメッセージにのみ適用されます。
- **グループ**: グループチャットでは、昇格ディレクティブはエージェントがメンションされた場合にのみ尊重されます。メンション要件を回避するコマンドのみのメッセージは、メンションされたものとして扱われます。
- **ホスト実行**: 昇格は `exec` を Gateway（ゲートウェイ）ホスト上に強制します。`full` はさらに `security=full` も設定します。
- **承認**: `full` は exec 承認をスキップします。`on`/`ask` は、許可リスト/確認ルールが要求する場合にそれらを尊重します。
- **サンドボックス化されていないエージェント**: 位置については no-op です。ゲーティング、ログ記録、ステータスにのみ影響します。
- **ツールポリシーは引き続き適用されます**: `exec` がツールポリシーにより拒否されている場合、昇格は使用できません。
- **`/exec` とは別物**: `/exec` は認可された送信者に対するセッション単位のデフォルトを調整し、昇格を必要としません。

## 解決順序

1. メッセージ上のインラインディレクティブ（そのメッセージにのみ適用）。
2. セッション上書き（ディレクティブのみのメッセージを送信して設定）。
3. グローバルデフォルト（設定内の `agents.defaults.elevatedDefault`）。

## セッションデフォルトの設定

- ディレクティブ**のみ**のメッセージを送信します（空白は許可されます）。例: `/elevated full`。
- 確認返信が送信されます（`Elevated mode set to full...` / `Elevated mode disabled.`）。
- 昇格アクセスが無効、または送信者が承認済み許可リストに載っていない場合、ディレクティブは対処可能なエラーを返信し、セッション状態は変更しません。
- 現在の昇格レベルを確認するには、引数なしで `/elevated`（または `/elevated:`）を送信します。

## 可用性 + 許可リスト

- 機能ゲート: `tools.elevated.enabled`（コードが対応していても、設定によりデフォルトで off にできます）。
- 送信者許可リスト: `tools.elevated.allowFrom` と、プロバイダー別許可リスト（例: `discord`、`whatsapp`）。
- エージェント単位のゲート: `agents.list[].tools.elevated.enabled`（任意。さらに制限することしかできません）。
- エージェント単位の許可リスト: `agents.list[].tools.elevated.allowFrom`（任意。設定されている場合、送信者はグローバル + エージェント単位の許可リストの**両方**に一致する必要があります）。
- Discord フォールバック: `tools.elevated.allowFrom.discord` が省略されている場合、`channels.discord.dm.allowFrom` リストがフォールバックとして使用されます。上書きするには `tools.elevated.allowFrom.discord`（`[]` であっても）を設定してください。エージェント単位の許可リストではフォールバックは使用され**ません**。
- すべてのゲートを通過する必要があります。そうでない場合、昇格は利用不可として扱われます。

## ログ記録 + ステータス

- 昇格 exec 呼び出しは info レベルでログに記録されます。
- セッションステータスには昇格モードが含まれます（例: `elevated=ask`、`elevated=full`）。
