---
summary: "Aplicativo complementar do OpenClaw para macOS (menu bar + broker do gateway)"
read_when:
  - Implementando recursos do aplicativo macOS
  - Alterando o ciclo de vida do gateway ou a ponte de nós no macOS
title: "Aplicativo macOS"
x-i18n:
  source_path: platforms/macos.md
  source_hash: a5b1c02e5905e4cb
  provider: openai
  model: gpt-5.2-chat-latest
  workflow: v1
  generated_at: 2026-02-08T06:57:09Z
---

# OpenClaw macOS Companion (menu bar + gateway broker)

O aplicativo macOS é o **companheiro de menu bar** do OpenClaw. Ele é responsável pelas permissões,
gerencia/conecta-se ao Gateway localmente (launchd ou manual), e expõe
capacidades do macOS ao agente como um nó.

## O que ele faz

- Mostra notificações nativas e status na menu bar.
- Controla prompts do TCC (Notificações, Acessibilidade, Gravação de Tela, Microfone,
  Reconhecimento de Fala, Automação/AppleScript).
- Executa ou conecta-se ao Gateway (local ou remoto).
- Expõe ferramentas exclusivas do macOS (Canvas, Câmera, Gravação de Tela, `system.run`).
- Inicia o serviço de host do nó local no modo **remoto** (launchd) e o interrompe no modo **local**.
- Opcionalmente hospeda o **PeekabooBridge** para automação de UI.
- Instala a CLI global (`openclaw`) via npm/pnpm sob demanda (bun não é recomendado para o runtime do Gateway).

## Modo local vs remoto

- **Local** (padrão): o app se conecta a um Gateway local em execução, se existir;
  caso contrário, habilita o serviço launchd via `openclaw gateway install`.
- **Remoto**: o app se conecta a um Gateway via SSH/Tailscale e nunca inicia
  um processo local.
  O app inicia o **serviço de host do nó** local para que o Gateway remoto possa alcançar este Mac.
  O app não cria o Gateway como processo filho.

## Controle do launchd

O app gerencia um LaunchAgent por usuário rotulado como `bot.molt.gateway`
(ou `bot.molt.<profile>` ao usar `--profile`/`OPENCLAW_PROFILE`; o legado `com.openclaw.*` ainda descarrega).

```bash
launchctl kickstart -k gui/$UID/bot.molt.gateway
launchctl bootout gui/$UID/bot.molt.gateway
```

Substitua o rótulo por `bot.molt.<profile>` ao executar um perfil nomeado.

Se o LaunchAgent não estiver instalado, habilite-o pelo app ou execute
`openclaw gateway install`.

## Capacidades do nó (mac)

O aplicativo macOS se apresenta como um nó. Comandos comuns:

- Canvas: `canvas.present`, `canvas.navigate`, `canvas.eval`, `canvas.snapshot`, `canvas.a2ui.*`
- Câmera: `camera.snap`, `camera.clip`
- Tela: `screen.record`
- Sistema: `system.run`, `system.notify`

O nó reporta um mapa de `permissions` para que os agentes decidam o que é permitido.

Serviço do nó + IPC do app:

- Quando o serviço headless de host do nó está em execução (modo remoto), ele se conecta ao WS do Gateway como um nó.
- `system.run` é executado no aplicativo macOS (contexto de UI/TCC) por meio de um socket Unix local; prompts e saídas permanecem no app.

Diagrama (SCI):

```
Gateway -> Node Service (WS)
                 |  IPC (UDS + token + HMAC + TTL)
                 v
             Mac App (UI + TCC + system.run)
```

## Aprovações de exec (system.run)

`system.run` é controlado por **Aprovações de Exec** no aplicativo macOS (Configurações → Aprovações de Exec).
Segurança + solicitação + allowlist são armazenadas localmente no Mac em:

```
~/.openclaw/exec-approvals.json
```

Exemplo:

```json
{
  "version": 1,
  "defaults": {
    "security": "deny",
    "ask": "on-miss"
  },
  "agents": {
    "main": {
      "security": "allowlist",
      "ask": "on-miss",
      "allowlist": [{ "pattern": "/opt/homebrew/bin/rg" }]
    }
  }
}
```

Notas:

- Entradas `allowlist` são padrões glob para caminhos de binários resolvidos.
- Escolher “Sempre Permitir” no prompt adiciona esse comando à allowlist.
- Substituições de ambiente `system.run` são filtradas (remove `PATH`, `DYLD_*`, `LD_*`, `NODE_OPTIONS`, `PYTHON*`, `PERL*`, `RUBYOPT`) e depois mescladas com o ambiente do app.

## Deep links

O app registra o esquema de URL `openclaw://` para ações locais.

### `openclaw://agent`

Dispara uma solicitação `agent` do Gateway.

```bash
open 'openclaw://agent?message=Hello%20from%20deep%20link'
```

Parâmetros de query:

- `message` (obrigatório)
- `sessionKey` (opcional)
- `thinking` (opcional)
- `deliver` / `to` / `channel` (opcional)
- `timeoutSeconds` (opcional)
- `key` (chave opcional de modo não assistido)

Segurança:

- Sem `key`, o app solicita confirmação.
- Com um `key` válido, a execução é não assistida (destinada a automações pessoais).

## Fluxo de integracao inicial (típico)

1. Instale e inicie **OpenClaw.app**.
2. Conclua a lista de permissões (prompts do TCC).
3. Garanta que o modo **Local** esteja ativo e que o Gateway esteja em execução.
4. Instale a CLI se quiser acesso via terminal.

## Build & dev workflow (nativo)

- `cd apps/macos && swift build`
- `swift run OpenClaw` (ou Xcode)
- Empacotar o app: `scripts/package-mac-app.sh`

## Depurar conectividade do gateway (CLI do macOS)

Use a CLI de debug para exercitar o mesmo handshake de WebSocket do Gateway e a lógica
de descoberta que o aplicativo macOS usa, sem iniciar o app.

```bash
cd apps/macos
swift run openclaw-mac connect --json
swift run openclaw-mac discover --timeout 3000 --json
```

Opções de conexão:

- `--url <ws://host:port>`: sobrescrever configuração
- `--mode <local|remote>`: resolver a partir da configuração (padrão: config ou local)
- `--probe`: forçar uma nova verificação de saúde
- `--timeout <ms>`: tempo limite da solicitação (padrão: `15000`)
- `--json`: saída estruturada para comparação

Opções de descoberta:

- `--include-local`: incluir gateways que seriam filtrados como “local”
- `--timeout <ms>`: janela geral de descoberta (padrão: `2000`)
- `--json`: saída estruturada para comparação

Dica: compare com `openclaw gateway discover --json` para ver se o pipeline de descoberta do app macOS
(NWBrowser + fallback de DNS‑SD do tailnet) difere da descoberta baseada em `dns-sd`
da CLI Node.

## Infraestrutura de conexão remota (túneis SSH)

Quando o aplicativo macOS é executado no modo **Remoto**, ele abre um túnel SSH para que
componentes de UI locais possam falar com um Gateway remoto como se ele estivesse em localhost.

### Túnel de controle (porta do WebSocket do Gateway)

- **Finalidade:** verificações de saúde, status, Web Chat, configuração e outras chamadas do plano de controle.
- **Porta local:** a porta do Gateway (padrão `18789`), sempre estável.
- **Porta remota:** a mesma porta do Gateway no host remoto.
- **Comportamento:** nenhuma porta local aleatória; o app reutiliza um túnel saudável existente
  ou o reinicia se necessário.
- **Forma do SSH:** `ssh -N -L <local>:127.0.0.1:<remote>` com BatchMode +
  ExitOnForwardFailure + opções de keepalive.
- **Relato de IP:** o túnel SSH usa loopback, então o gateway verá o IP do nó como `127.0.0.1`.
  Use transporte **Direto (ws/wss)** se quiser que o IP real do cliente apareça
  (veja [acesso remoto no macOS](/platforms/mac/remote)).

Para etapas de configuração, veja [acesso remoto no macOS](/platforms/mac/remote). Para detalhes
do protocolo, veja [protocolo do Gateway](/gateway/protocol).

## Documentos relacionados

- [Runbook do Gateway](/gateway)
- [Gateway (macOS)](/platforms/mac/bundled-gateway)
- [Permissões do macOS](/platforms/mac/permissions)
- [Canvas](/platforms/mac/canvas)
