---
summary: "메뉴 바 상태 로직과 사용자에게 노출되는 내용"
read_when:
  - mac 메뉴 UI 또는 상태 로직을 조정할 때
title: "메뉴 바"
x-i18n:
  source_path: platforms/mac/menu-bar.md
  source_hash: 8eb73c0e671a76aa
  provider: openai
  model: gpt-5.2-chat-latest
  workflow: v1
  generated_at: 2026-02-08T06:40:04Z
---

# 메뉴 바 상태 로직

## 표시되는 내용

- 메뉴 바 아이콘과 메뉴의 첫 번째 상태 행에 현재 에이전트의 작업 상태를 표시합니다.
- 작업이 활성화되어 있는 동안에는 상태(헬스) 정보가 숨겨지며, 모든 세션이 유휴 상태가 되면 다시 표시됩니다.
- 메뉴의 'Nodes' 블록에는 **디바이스**만 나열됩니다(`node.list`을 통해 페어링된 노드). 클라이언트/프레즌스 항목은 포함되지 않습니다.
- 프로바이더 사용량 스냅샷을 사용할 수 있을 때 Context 아래에 'Usage' 섹션이 표시됩니다.

## 상태 모델

- 세션: 이벤트는 `runId`(실행별)과 페이로드의 `sessionKey`를 포함하여 도착합니다. '메인' 세션은 키 `main`입니다. 없을 경우 가장 최근에 업데이트된 세션으로 폴백합니다.
- 우선순위: 메인은 항상 우선합니다. 메인이 활성 상태이면 즉시 해당 상태가 표시됩니다. 메인이 유휴 상태이면 가장 최근에 활성화된 비메인 세션이 표시됩니다. 활동 중에는 상태를 번갈아 바꾸지 않으며, 현재 세션이 유휴 상태가 되거나 메인이 활성화될 때만 전환합니다.
- 활동 종류:
  - `job`: 상위 수준 명령 실행(`state: started|streaming|done|error`).
  - `tool`: `toolName` 및 `meta/args`를 포함한 `phase: start|result`.

## IconState enum (Swift)

- `idle`
- `workingMain(ActivityKind)`
- `workingOther(ActivityKind)`
- `overridden(ActivityKind)` (디버그 오버라이드)

### ActivityKind → 글리프

- `exec` → 💻
- `read` → 📄
- `write` → ✍️
- `edit` → 📝
- `attach` → 📎
- 기본값 → 🛠️

### 시각적 매핑

- `idle`: 일반 크리터.
- `workingMain`: 글리프가 있는 배지, 전체 틴트, 다리 '작업 중' 애니메이션.
- `workingOther`: 글리프가 있는 배지, 약한 틴트, 이동 애니메이션 없음.
- `overridden`: 활동과 관계없이 선택된 글리프/틴트를 사용합니다.

## 상태 행 텍스트 (메뉴)

- 작업이 활성 상태일 때: `<Session role> · <activity label>`
  - 예시: `Main · exec: pnpm test`, `Other · read: apps/macos/Sources/OpenClaw/AppState.swift`.
- 유휴 상태일 때: 상태 요약으로 폴백합니다.

## 이벤트 수집

- 소스: 제어 채널의 `agent` 이벤트(`ControlChannel.handleAgentEvent`).
- 파싱 필드:
  - 시작/중지를 위한 `data.state`를 포함한 `stream: "job"`.
  - `data.phase`, `name`, 선택적 `meta`/`args`를 포함한 `stream: "tool"`.
- 레이블:
  - `exec`: `args.command`의 첫 줄.
  - `read`/`write`: 축약된 경로.
  - `edit`: `meta`/diff 카운트로부터 추론한 변경 종류를 포함한 경로.
  - 폴백: 도구 이름.

## 디버그 오버라이드

- 설정 ▸ 디버그 ▸ 'Icon override' 선택기:
  - `System (auto)` (기본값)
  - `Working: main` (도구 종류별)
  - `Working: other` (도구 종류별)
  - `Idle`
- `@AppStorage("iconOverride")`를 통해 저장되며, `IconState.overridden`에 매핑됩니다.

## 테스트 체크리스트

- 메인 세션 작업 트리거: 아이콘이 즉시 전환되고 상태 행에 메인 레이블이 표시되는지 확인합니다.
- 메인이 유휴 상태일 때 비메인 세션 작업 트리거: 아이콘/상태가 비메인을 표시하고, 완료될 때까지 안정적으로 유지되는지 확인합니다.
- 다른 세션이 활성 상태일 때 메인 시작: 아이콘이 즉시 메인으로 전환되는지 확인합니다.
- 빠른 도구 연속 실행: 배지가 깜빡이지 않는지 확인합니다(도구 결과에 대한 TTL 유예).
- 모든 세션이 유휴 상태가 되면 상태 행이 다시 나타나는지 확인합니다.
