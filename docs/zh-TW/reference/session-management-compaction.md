---
summary: "æ·±å…¥è§£æï¼šå·¥ä½œéšæ®µå„²å­˜å€ + é€å­—ç¨¿ã€ç”Ÿå‘½é€±æœŸï¼Œä»¥åŠï¼ˆè‡ªå‹•ï¼‰å£“ç¸®çš„å…§éƒ¨æ©Ÿåˆ¶"
read_when:
  - ä½ éœ€è¦é™¤éŒ¯å·¥ä½œéšæ®µ idã€é€å­—ç¨¿ JSONLï¼Œæˆ– sessions.json æ¬„ä½
  - ä½ æ­£åœ¨è®Šæ›´è‡ªå‹•å£“ç¸®è¡Œç‚ºï¼Œæˆ–æ–°å¢ã€Œå£“ç¸®å‰ã€çš„ä¾‹è¡Œæ•´ç†å·¥ä½œ
  - ä½ æƒ³è¦å¯¦ä½œè¨˜æ†¶é«”å¯«å…¥æˆ–éœé»˜çš„ç³»çµ±å›åˆ
title: "å·¥ä½œéšæ®µç®¡ç†æ·±å…¥è§£æ"
x-i18n:
  source_path: reference/session-management-compaction.md
  source_hash: bf3715770ba63436
  provider: openai
  model: gpt-5.2-chat-latest
  workflow: v1
  generated_at: 2026-02-08T06:54:52Z
---

# å·¥ä½œéšæ®µç®¡ç†èˆ‡å£“ç¸®ï¼ˆæ·±å…¥è§£æï¼‰

æœ¬æ–‡ä»¶èªªæ˜ OpenClaw å¦‚ä½•ç«¯åˆ°ç«¯ç®¡ç†å·¥ä½œéšæ®µï¼š

- **å·¥ä½œéšæ®µè·¯ç”±**ï¼ˆå‚³å…¥è¨Šæ¯å¦‚ä½•å°æ‡‰åˆ°ä¸€å€‹ `sessionKey`ï¼‰
- **å·¥ä½œéšæ®µå„²å­˜å€**ï¼ˆ`sessions.json`ï¼‰ä»¥åŠå®ƒæ‰€è¿½è¹¤çš„å…§å®¹
- **é€å­—ç¨¿æŒä¹…åŒ–**ï¼ˆ`*.jsonl`ï¼‰åŠå…¶çµæ§‹
- **é€å­—ç¨¿è¡›ç”Ÿ**ï¼ˆåŸ·è¡Œå‰çš„æä¾›è€…ç‰¹å®šä¿®è£œï¼‰
- **ä¸Šä¸‹æ–‡é™åˆ¶**ï¼ˆä¸Šä¸‹æ–‡è¦–çª— vs å·²è¿½è¹¤çš„ tokenï¼‰
- **å£“ç¸®**ï¼ˆæ‰‹å‹• + è‡ªå‹•å£“ç¸®ï¼‰ä»¥åŠå¯æ›è¼‰å£“ç¸®å‰å·¥ä½œçš„åœ°æ–¹
- **éœé»˜ä¾‹è¡Œæ•´ç†**ï¼ˆä¾‹å¦‚ä¸æ‡‰ç”¢ç”Ÿä½¿ç”¨è€…å¯è¦‹è¼¸å‡ºçš„è¨˜æ†¶é«”å¯«å…¥ï¼‰

å¦‚æœä½ æƒ³å…ˆçœ‹è¼ƒé«˜å±¤æ¬¡çš„æ¦‚è¦½ï¼Œè«‹å¾ä»¥ä¸‹é–‹å§‹ï¼š

- [/concepts/session](/concepts/session)
- [/concepts/compaction](/concepts/compaction)
- [/concepts/session-pruning](/concepts/session-pruning)
- [/reference/transcript-hygiene](/reference/transcript-hygiene)

---

## å–®ä¸€äº‹å¯¦ä¾†æºï¼šGateway é–˜é“å™¨

OpenClaw çš„è¨­è¨ˆä»¥å–®ä¸€ **Gateway process** ç‚ºæ ¸å¿ƒï¼Œè² è²¬æ“æœ‰å·¥ä½œéšæ®µç‹€æ…‹ã€‚

- UIï¼ˆmacOS appã€ç¶²é  Control UIã€TUIï¼‰æ‡‰å‘ Gateway æŸ¥è©¢å·¥ä½œéšæ®µæ¸…å–®èˆ‡ token è¨ˆæ•¸ã€‚
- åœ¨é ç«¯æ¨¡å¼ä¸‹ï¼Œå·¥ä½œéšæ®µæª”æ¡ˆä½æ–¼é ç«¯ä¸»æ©Ÿï¼›ã€Œæª¢æŸ¥ä½ æœ¬æ©Ÿ Mac çš„æª”æ¡ˆã€ä¸æœƒåæ˜  Gateway å¯¦éš›ä½¿ç”¨çš„å…§å®¹ã€‚

---

## å…©å±¤æŒä¹…åŒ–

OpenClaw ä»¥å…©å±¤æ–¹å¼æŒä¹…åŒ–å·¥ä½œéšæ®µï¼š

1. **å·¥ä½œéšæ®µå„²å­˜å€ï¼ˆ`sessions.json`ï¼‰**
   - Key/value å°æ˜ ï¼š`sessionKey -> SessionEntry`
   - å°å‹ã€å¯è®Šæ›´ï¼Œä¸”å¯å®‰å…¨ç·¨è¼¯ï¼ˆæˆ–åˆªé™¤é …ç›®ï¼‰
   - è¿½è¹¤å·¥ä½œéšæ®µä¸­ç¹¼è³‡æ–™ï¼ˆç›®å‰çš„å·¥ä½œéšæ®µ idã€æœ€å¾Œæ´»å‹•æ™‚é–“ã€åˆ‡æ›é …ç›®ã€token è¨ˆæ•¸å™¨ç­‰ï¼‰

2. **é€å­—ç¨¿ï¼ˆ`<sessionId>.jsonl`ï¼‰**
   - å…·æ¨¹ç‹€çµæ§‹çš„é™„åŠ å¯«å…¥é€å­—ç¨¿ï¼ˆé …ç›®å…·æœ‰ `id` + `parentId`ï¼‰
   - å„²å­˜å¯¦éš›çš„å°è©± + å·¥å…·å‘¼å« + å£“ç¸®æ‘˜è¦
   - ç”¨æ–¼é‡å»ºå¾ŒçºŒå›åˆçš„æ¨¡å‹ä¸Šä¸‹æ–‡

---

## ç£ç¢Ÿä¸Šçš„ä½ç½®

æ¯å€‹ä»£ç†ç¨‹å¼ï¼Œåœ¨ Gateway ä¸»æ©Ÿä¸Šï¼š

- å„²å­˜å€ï¼š`~/.openclaw/agents/<agentId>/sessions/sessions.json`
- é€å­—ç¨¿ï¼š`~/.openclaw/agents/<agentId>/sessions/<sessionId>.jsonl`
  - Telegram ä¸»é¡Œå·¥ä½œéšæ®µï¼š`.../<sessionId>-topic-<threadId>.jsonl`

OpenClaw é€é `src/config/sessions.ts` è§£æé€™äº›è·¯å¾‘ã€‚

---

## å·¥ä½œéšæ®µéµï¼ˆ`sessionKey`ï¼‰

ä¸€å€‹ `sessionKey` ç”¨ä¾†è­˜åˆ¥ä½ ç›®å‰æ‰€åœ¨çš„ã€Œå°è©±æ¡¶ã€ï¼ˆè·¯ç”± + éš”é›¢ï¼‰ã€‚

å¸¸è¦‹æ¨¡å¼ï¼š

- ä¸»ï¼ç›´æ¥èŠå¤©ï¼ˆæ¯å€‹ä»£ç†ç¨‹å¼ï¼‰ï¼š`agent:<agentId>:<mainKey>`ï¼ˆé è¨­ `main`ï¼‰
- ç¾¤çµ„ï¼š`agent:<agentId>:<channel>:group:<id>`
- æˆ¿é–“ï¼é »é“ï¼ˆDiscord/Slackï¼‰ï¼š`agent:<agentId>:<channel>:channel:<id>` æˆ– `...:room:<id>`
- Cronï¼š`cron:<job.id>`
- Webhookï¼š`hook:<uuid>`ï¼ˆé™¤éè¢«è¦†å¯«ï¼‰

æ­£å¼è¦å‰‡è¨˜è¼‰æ–¼ [/concepts/session](/concepts/session)ã€‚

---

## å·¥ä½œéšæ®µ idï¼ˆ`sessionId`ï¼‰

æ¯å€‹ `sessionKey` éƒ½æŒ‡å‘ä¸€å€‹ç›®å‰çš„ `sessionId`ï¼ˆæŒçºŒè©²å°è©±çš„é€å­—ç¨¿æª”æ¡ˆï¼‰ã€‚

ç¶“é©—æ³•å‰‡ï¼š

- **é‡è¨­**ï¼ˆ`/new`ã€`/reset`ï¼‰æœƒç‚ºè©² `sessionKey` å»ºç«‹æ–°çš„ `sessionId`ã€‚
- **æ¯æ—¥é‡è¨­**ï¼ˆé è¨­ç‚º Gateway ä¸»æ©Ÿæœ¬åœ°æ™‚é–“å‡Œæ™¨ 4:00ï¼‰æœƒåœ¨è·¨è¶Šé‡è¨­é‚Šç•Œå¾Œçš„ä¸‹ä¸€å‰‡è¨Šæ¯å»ºç«‹æ–°çš„ `sessionId`ã€‚
- **é–’ç½®åˆ°æœŸ**ï¼ˆ`session.reset.idleMinutes` æˆ–èˆŠç‰ˆ `session.idleMinutes`ï¼‰æœƒåœ¨è¶…éé–’ç½®è¦–çª—å¾Œæ”¶åˆ°è¨Šæ¯æ™‚å»ºç«‹æ–°çš„ `sessionId`ã€‚ç•¶æ¯æ—¥èˆ‡é–’ç½®åŒæ™‚è¨­å®šæ™‚ï¼Œä»¥å…ˆåˆ°æœŸè€…ç‚ºæº–ã€‚

å¯¦ä½œç´°ç¯€ï¼šæ±ºç­–ç™¼ç”Ÿæ–¼ `src/auto-reply/reply/session.ts` ä¸­çš„ `initSessionState()`ã€‚

---

## å·¥ä½œéšæ®µå„²å­˜å€çµæ§‹ï¼ˆ`sessions.json`ï¼‰

å„²å­˜å€çš„å€¼å‹åˆ¥æ˜¯ `src/config/sessions.ts` ä¸­çš„ `SessionEntry`ã€‚

é—œéµæ¬„ä½ï¼ˆéå®Œæ•´æ¸…å–®ï¼‰ï¼š

- `sessionId`ï¼šç›®å‰çš„é€å­—ç¨¿ idï¼ˆé™¤éè¨­å®š `sessionFile`ï¼Œå¦å‰‡æª”åç”±æ­¤æ¨å°ï¼‰
- `updatedAt`ï¼šæœ€å¾Œæ´»å‹•æ™‚é–“æˆ³
- `sessionFile`ï¼šå¯é¸çš„æ˜ç¢ºé€å­—ç¨¿è·¯å¾‘è¦†å¯«
- `chatType`ï¼š`direct | group | room`ï¼ˆå”åŠ© UI èˆ‡å‚³é€ç­–ç•¥ï¼‰
- `provider`ã€`subject`ã€`room`ã€`space`ã€`displayName`ï¼šç¾¤çµ„ï¼é »é“æ¨™ç±¤çš„ä¸­ç¹¼è³‡æ–™
- åˆ‡æ›é …ç›®ï¼š
  - `thinkingLevel`ã€`verboseLevel`ã€`reasoningLevel`ã€`elevatedLevel`
  - `sendPolicy`ï¼ˆæ¯å€‹å·¥ä½œéšæ®µçš„è¦†å¯«ï¼‰
- æ¨¡å‹é¸æ“‡ï¼š
  - `providerOverride`ã€`modelOverride`ã€`authProfileOverride`
- Token è¨ˆæ•¸å™¨ï¼ˆç›¡åŠ›è€Œç‚ºï¼ä¾æä¾›è€…è€Œç•°ï¼‰ï¼š
  - `inputTokens`ã€`outputTokens`ã€`totalTokens`ã€`contextTokens`
- `compactionCount`ï¼šæ­¤å·¥ä½œéšæ®µéµå®Œæˆè‡ªå‹•å£“ç¸®çš„æ¬¡æ•¸
- `memoryFlushAt`ï¼šä¸Šä¸€æ¬¡å£“ç¸®å‰è¨˜æ†¶é«”å¯«å…¥çš„æ™‚é–“æˆ³
- `memoryFlushCompactionCount`ï¼šæœ€å¾Œä¸€æ¬¡å¯«å…¥æ™‚çš„å£“ç¸®è¨ˆæ•¸

å„²å­˜å€å¯å®‰å…¨ç·¨è¼¯ï¼Œä½† Gateway æ˜¯æ¬Šå¨ä¾†æºï¼šåœ¨å·¥ä½œéšæ®µåŸ·è¡ŒæœŸé–“ï¼Œå®ƒå¯èƒ½æœƒé‡å¯«æˆ–é‡æ–°è£œé½Šé …ç›®ã€‚

---

## é€å­—ç¨¿çµæ§‹ï¼ˆ`*.jsonl`ï¼‰

é€å­—ç¨¿ç”± `@mariozechner/pi-coding-agent` çš„ `SessionManager` ç®¡ç†ã€‚

æª”æ¡ˆæ ¼å¼ç‚º JSONLï¼š

- ç¬¬ä¸€è¡Œï¼šå·¥ä½œéšæ®µæ¨™é ­ï¼ˆ`type: "session"`ï¼ŒåŒ…å« `id`ã€`cwd`ã€`timestamp`ï¼Œä»¥åŠå¯é¸çš„ `parentSession`ï¼‰
- æ¥è‘—ï¼šå…·æœ‰ `id` + `parentId`ï¼ˆæ¨¹ç‹€ï¼‰çš„å·¥ä½œéšæ®µé …ç›®

å€¼å¾—æ³¨æ„çš„é …ç›®é¡å‹ï¼š

- `message`ï¼šä½¿ç”¨è€…ï¼åŠ©ç†ï¼toolResult è¨Šæ¯
- `custom_message`ï¼šç”±æ“´å……åŠŸèƒ½æ³¨å…¥ã€ä¸”ã€Œæœƒã€é€²å…¥æ¨¡å‹ä¸Šä¸‹æ–‡çš„è¨Šæ¯ï¼ˆå¯å° UI éš±è—ï¼‰
- `custom`ï¼šæ“´å……åŠŸèƒ½ç‹€æ…‹ï¼Œä¸”ã€Œä¸æœƒã€é€²å…¥æ¨¡å‹ä¸Šä¸‹æ–‡
- `compaction`ï¼šæŒä¹…åŒ–çš„å£“ç¸®æ‘˜è¦ï¼ŒåŒ…å« `firstKeptEntryId` èˆ‡ `tokensBefore`
- `branch_summary`ï¼šåœ¨ç€è¦½æ¨¹ç‹€åˆ†æ”¯æ™‚æŒä¹…åŒ–çš„æ‘˜è¦

OpenClaw æœ‰æ„ **ä¸**ã€Œä¿®è£œã€é€å­—ç¨¿ï¼›Gateway ä½¿ç”¨ `SessionManager` ä¾†è®€å¯«å®ƒå€‘ã€‚

---

## ä¸Šä¸‹æ–‡è¦–çª— vs å·²è¿½è¹¤ token

æœ‰å…©å€‹ä¸åŒçš„æ¦‚å¿µéœ€è¦æ³¨æ„ï¼š

1. **æ¨¡å‹ä¸Šä¸‹æ–‡è¦–çª—**ï¼šæ¯å€‹æ¨¡å‹çš„ç¡¬æ€§ä¸Šé™ï¼ˆæ¨¡å‹å¯è¦‹çš„ tokenï¼‰
2. **å·¥ä½œéšæ®µå„²å­˜å€è¨ˆæ•¸å™¨**ï¼šå¯«å…¥ `sessions.json` çš„æ»¾å‹•çµ±è¨ˆï¼ˆç”¨æ–¼ /status èˆ‡å„€è¡¨æ¿ï¼‰

è‹¥ä½ æ­£åœ¨èª¿æ ¡é™åˆ¶ï¼š

- ä¸Šä¸‹æ–‡è¦–çª—ä¾†è‡ªæ¨¡å‹ç›®éŒ„ï¼ˆå¯é€éè¨­å®šè¦†å¯«ï¼‰ã€‚
- å„²å­˜å€ä¸­çš„ `contextTokens` æ˜¯åŸ·è¡ŒæœŸä¼°ç®—ï¼å›å ±å€¼ï¼›è«‹å‹¿å°‡å…¶è¦–ç‚ºåš´æ ¼ä¿è­‰ã€‚

æ›´å¤šè³‡è¨Šè«‹è¦‹ [/token-use](/token-use)ã€‚

---

## å£“ç¸®ï¼šå®ƒæ˜¯ä»€éº¼

å£“ç¸®æœƒå°‡è¼ƒèˆŠçš„å°è©±æ‘˜è¦ç‚ºé€å­—ç¨¿ä¸­ä¸€å€‹æŒä¹…åŒ–çš„ `compaction` é …ç›®ï¼Œä¸¦ä¿ç•™è¿‘æœŸè¨Šæ¯ä¸è®Šã€‚

å£“ç¸®å¾Œï¼Œå¾ŒçºŒå›åˆæœƒçœ‹åˆ°ï¼š

- å£“ç¸®æ‘˜è¦
- `firstKeptEntryId` ä¹‹å¾Œçš„è¨Šæ¯

å£“ç¸®æ˜¯ **æŒä¹…åŒ–çš„**ï¼ˆä¸åŒæ–¼å·¥ä½œéšæ®µä¿®å‰ªï¼‰ã€‚è«‹è¦‹ [/concepts/session-pruning](/concepts/session-pruning)ã€‚

---

## è‡ªå‹•å£“ç¸®ä½•æ™‚ç™¼ç”Ÿï¼ˆPi runtimeï¼‰

åœ¨åµŒå…¥å¼ Pi ä»£ç†ç¨‹å¼ä¸­ï¼Œè‡ªå‹•å£“ç¸®åœ¨å…©ç¨®æƒ…æ³ä¸‹è§¸ç™¼ï¼š

1. **æº¢ä½å¾©åŸ**ï¼šæ¨¡å‹å›å‚³ä¸Šä¸‹æ–‡æº¢ä½éŒ¯èª¤ â†’ å£“ç¸® â†’ é‡è©¦ã€‚
2. **é–€æª»ç¶­æŒ**ï¼šåœ¨æˆåŠŸå®Œæˆä¸€å€‹å›åˆå¾Œï¼Œç•¶ï¼š

`contextTokens > contextWindow - reserveTokens`

å…¶ä¸­ï¼š

- `contextWindow` æ˜¯æ¨¡å‹çš„ä¸Šä¸‹æ–‡è¦–çª—
- `reserveTokens` æ˜¯ç‚ºæç¤ºè© + ä¸‹ä¸€æ¬¡æ¨¡å‹è¼¸å‡ºä¿ç•™çš„ç·©è¡ç©ºé–“

é€™äº›æ˜¯ Pi runtime çš„èªç¾©ï¼ˆOpenClaw æœƒæ¶ˆè²»äº‹ä»¶ï¼Œä½†æ˜¯å¦å£“ç¸®ç”± Pi æ±ºå®šï¼‰ã€‚

---

## å£“ç¸®è¨­å®šï¼ˆ`reserveTokens`ã€`keepRecentTokens`ï¼‰

Pi çš„å£“ç¸®è¨­å®šä½æ–¼ Pi è¨­å®šä¸­ï¼š

```json5
{
  compaction: {
    enabled: true,
    reserveTokens: 16384,
    keepRecentTokens: 20000,
  },
}
```

OpenClaw ä¹Ÿæœƒå°åµŒå…¥å¼åŸ·è¡Œå¥—ç”¨å®‰å…¨ä¸‹é™ï¼š

- è‹¥ `compaction.reserveTokens < reserveTokensFloor`ï¼ŒOpenClaw æœƒæé«˜å®ƒã€‚
- é è¨­ä¸‹é™ç‚º `20000` å€‹ tokenã€‚
- è¨­å®š `agents.defaults.compaction.reserveTokensFloor: 0` å¯åœç”¨æ­¤ä¸‹é™ã€‚
- è‹¥åŸæœ¬å·²æ›´é«˜ï¼ŒOpenClaw æœƒä¿æŒä¸è®Šã€‚

åŸå› ï¼šåœ¨å£“ç¸®ä¸å¯é¿å…ä¹‹å‰ï¼Œä¿ç•™è¶³å¤ ç©ºé–“ä»¥é€²è¡Œå¤šå›åˆçš„ã€Œä¾‹è¡Œæ•´ç†ã€ï¼ˆä¾‹å¦‚è¨˜æ†¶é«”å¯«å…¥ï¼‰ã€‚

å¯¦ä½œä½ç½®ï¼š`src/agents/pi-settings.ts` ä¸­çš„ `ensurePiCompactionReserveTokens()`
ï¼ˆç”± `src/agents/pi-embedded-runner.ts` å‘¼å«ï¼‰ã€‚

---

## ä½¿ç”¨è€…å¯è¦‹çš„ä»‹é¢

ä½ å¯ä»¥é€éä»¥ä¸‹æ–¹å¼è§€å¯Ÿå£“ç¸®èˆ‡å·¥ä½œéšæ®µç‹€æ…‹ï¼š

- `/status`ï¼ˆä»»ä½•èŠå¤©å·¥ä½œéšæ®µä¸­ï¼‰
- `openclaw status`ï¼ˆCLIï¼‰
- `openclaw sessions` / `sessions --json`
- è©³ç´°æ¨¡å¼ï¼š`ğŸ§¹ Auto-compaction complete` + å£“ç¸®è¨ˆæ•¸

---

## éœé»˜ä¾‹è¡Œæ•´ç†ï¼ˆ`NO_REPLY`ï¼‰

OpenClaw æ”¯æ´ã€Œéœé»˜ã€å›åˆï¼Œç”¨æ–¼ä½¿ç”¨è€…ä¸æ‡‰çœ‹åˆ°ä¸­é–“è¼¸å‡ºçš„èƒŒæ™¯ä»»å‹™ã€‚

æ…£ä¾‹ï¼š

- åŠ©ç†çš„è¼¸å‡ºä»¥ `NO_REPLY` é–‹é ­ï¼Œè¡¨ç¤ºã€Œä¸è¦å‘ä½¿ç”¨è€…å‚³éå›è¦†ã€ã€‚
- OpenClaw æœƒåœ¨å‚³éå±¤å‰é™¤ï¼æŠ‘åˆ¶é€™äº›å…§å®¹ã€‚

è‡ª `2026.1.10` èµ·ï¼Œç•¶éƒ¨åˆ†ä¸²æµå€å¡Šä»¥ `NO_REPLY` é–‹é ­æ™‚ï¼ŒOpenClaw ä¹ŸæœƒæŠ‘åˆ¶ **è‰ç¨¿ï¼è¼¸å…¥ä¸­ä¸²æµ**ï¼Œé¿å…éœé»˜æ“ä½œåœ¨å›åˆä¸­é€”æ´©æ¼éƒ¨åˆ†è¼¸å‡ºã€‚

---

## å£“ç¸®å‰ã€Œè¨˜æ†¶é«”å¯«å…¥ã€ï¼ˆå·²å¯¦ä½œï¼‰

ç›®æ¨™ï¼šåœ¨è‡ªå‹•å£“ç¸®ç™¼ç”Ÿå‰ï¼ŒåŸ·è¡Œä¸€æ¬¡éœé»˜çš„ä»£ç†ç¨‹å¼å›åˆï¼Œå°‡æŒä¹…ç‹€æ…‹å¯«å…¥ç£ç¢Ÿ
ï¼ˆä¾‹å¦‚ä»£ç†ç¨‹å¼å·¥ä½œå€ä¸­çš„ `memory/YYYY-MM-DD.md`ï¼‰ï¼Œè®“å£“ç¸®ç„¡æ³•
æŠ¹é™¤é—œéµä¸Šä¸‹æ–‡ã€‚

OpenClaw æ¡ç”¨ **é–€æª»å‰å¯«å…¥** çš„æ–¹å¼ï¼š

1. ç›£æ§å·¥ä½œéšæ®µçš„ä¸Šä¸‹æ–‡ä½¿ç”¨é‡ã€‚
2. ç•¶å…¶è·¨è¶Šã€Œè»Ÿé–€æª»ã€ï¼ˆä½æ–¼ Pi çš„å£“ç¸®é–€æª»ï¼‰æ™‚ï¼Œå‘ä»£ç†ç¨‹å¼åŸ·è¡Œä¸€æ¬¡éœé»˜çš„
   ã€Œç«‹å³å¯«å…¥è¨˜æ†¶é«”ã€æŒ‡ä»¤ã€‚
3. ä½¿ç”¨ `NO_REPLY`ï¼Œè®“ä½¿ç”¨è€…ä»€éº¼éƒ½çœ‹ä¸åˆ°ã€‚

è¨­å®šï¼ˆ`agents.defaults.compaction.memoryFlush`ï¼‰ï¼š

- `enabled`ï¼ˆé è¨­ï¼š`true`ï¼‰
- `softThresholdTokens`ï¼ˆé è¨­ï¼š`4000`ï¼‰
- `prompt`ï¼ˆå¯«å…¥å›åˆçš„ä½¿ç”¨è€…è¨Šæ¯ï¼‰
- `systemPrompt`ï¼ˆç‚ºå¯«å…¥å›åˆé™„åŠ çš„é¡å¤–ç³»çµ±æç¤ºï¼‰

å‚™è¨»ï¼š

- é è¨­æç¤ºèˆ‡ç³»çµ±æç¤ºåŒ…å« `NO_REPLY` æç¤ºä»¥æŠ‘åˆ¶å‚³éã€‚
- æ¯å€‹å£“ç¸®å¾ªç’°åªæœƒåŸ·è¡Œä¸€æ¬¡å¯«å…¥ï¼ˆè¨˜éŒ„æ–¼ `sessions.json`ï¼‰ã€‚
- å¯«å…¥åƒ…é©ç”¨æ–¼åµŒå…¥å¼ Pi å·¥ä½œéšæ®µï¼ˆCLI å¾Œç«¯æœƒç•¥éï¼‰ã€‚
- ç•¶å·¥ä½œéšæ®µå·¥ä½œå€ç‚ºå”¯è®€æ™‚æœƒç•¥éå¯«å…¥ï¼ˆ`workspaceAccess: "ro"` æˆ– `"none"`ï¼‰ã€‚
- å·¥ä½œå€æª”æ¡ˆé…ç½®èˆ‡å¯«å…¥æ¨¡å¼è«‹è¦‹ [Memory](/concepts/memory)ã€‚

Pi ä¹Ÿåœ¨æ“´å……åŠŸèƒ½ API ä¸­æä¾› `session_before_compact` æ›é‰¤ï¼Œä½† OpenClaw çš„
å¯«å…¥é‚è¼¯ç›®å‰ä½æ–¼ Gateway ç«¯ã€‚

---

## ç–‘é›£æ’è§£æª¢æŸ¥æ¸…å–®

- å·¥ä½œéšæ®µéµéŒ¯èª¤ï¼Ÿå¾ [/concepts/session](/concepts/session) é–‹å§‹ï¼Œä¸¦ç¢ºèª `/status` ä¸­çš„ `sessionKey`ã€‚
- å„²å­˜å€èˆ‡é€å­—ç¨¿ä¸ä¸€è‡´ï¼Ÿç¢ºèª Gateway ä¸»æ©Ÿï¼Œä»¥åŠä¾†è‡ª `openclaw status` çš„å„²å­˜å€è·¯å¾‘ã€‚
- å£“ç¸®éæ–¼é »ç¹ï¼Ÿæª¢æŸ¥ï¼š
  - æ¨¡å‹ä¸Šä¸‹æ–‡è¦–çª—ï¼ˆæ˜¯å¦éå°ï¼‰
  - å£“ç¸®è¨­å®šï¼ˆ`reserveTokens` å°æ–¼æ¨¡å‹è¦–çª—éé«˜æœƒå°è‡´ææ—©å£“ç¸®ï¼‰
  - å·¥å…·çµæœè†¨è„¹ï¼šå•Ÿç”¨ï¼èª¿æ ¡å·¥ä½œéšæ®µä¿®å‰ª
- éœé»˜å›åˆå¤–æ´©ï¼Ÿç¢ºèªå›è¦†ä»¥ `NO_REPLY`ï¼ˆå®Œå…¨ç›¸åŒçš„ tokenï¼‰é–‹é ­ï¼Œä¸”ä½ ä½¿ç”¨çš„ç‰ˆæœ¬åŒ…å«ä¸²æµæŠ‘åˆ¶ä¿®æ­£ã€‚
