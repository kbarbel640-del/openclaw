---
summary: "Agenten-Sitzungswerkzeuge zum Auflisten von Sitzungen, Abrufen des Verlaufs und Senden von sitzungsübergreifenden Nachrichten"
read_when:
  - Hinzufügen oder Ändern von Sitzungswerkzeugen
title: "Sitzungswerkzeuge"
x-i18n:
  source_path: concepts/session-tool.md
  source_hash: cb6e0982ebf507bc
  provider: openai
  model: gpt-5.2-chat-latest
  workflow: v1
  generated_at: 2026-02-08T07:04:15Z
---

# Sitzungswerkzeuge

Ziel: kleines, schwer fehlzubenutzendes Werkzeugsset, damit Agenten Sitzungen auflisten, den Verlauf abrufen und an eine andere Sitzung senden können.

## Werkzeugnamen

- `sessions_list`
- `sessions_history`
- `sessions_send`
- `sessions_spawn`

## Schlüsselmodell

- Der Haupt‑Direktchat‑Bucket ist immer der literale Schlüssel `"main"` (auf den Hauptschlüssel des aktuellen Agenten aufgelöst).
- Gruppenchats verwenden `agent:<agentId>:<channel>:group:<id>` oder `agent:<agentId>:<channel>:channel:<id>` (den vollständigen Schlüssel übergeben).
- Cron‑Jobs verwenden `cron:<job.id>`.
- Hooks verwenden `hook:<uuid>`, sofern nicht explizit gesetzt.
- Node‑Sitzungen verwenden `node-<nodeId>`, sofern nicht explizit gesetzt.

`global` und `unknown` sind reservierte Werte und werden niemals gelistet. Falls `session.scope = "global"`, wird es für alle Werkzeuge auf `main` aliasiert, sodass Aufrufer niemals `global` sehen.

## sessions_list

Listet Sitzungen als Array von Zeilen auf.

Parameter:

- `kinds?: string[]`‑Filter: einer von `"main" | "group" | "cron" | "hook" | "node" | "other"`
- `limit?: number` maximale Zeilen (Standard: Server‑Standard, z. B. Begrenzung auf 200)
- `activeMinutes?: number` nur Sitzungen, die innerhalb von N Minuten aktualisiert wurden
- `messageLimit?: number` 0 = keine Nachrichten (Standard 0); >0 = letzte N Nachrichten einschließen

Verhalten:

- `messageLimit > 0` ruft `chat.history` pro Sitzung ab und schließt die letzten N Nachrichten ein.
- Werkzeugergebnisse werden in der Listenausgabe herausgefiltert; verwenden Sie `sessions_history` für Werkzeugnachrichten.
- Beim Ausführen in einer **in einer Sandbox** befindlichen Agenten‑Sitzung verwenden Sitzungswerkzeuge standardmäßig **nur Sichtbarkeit für gespawnte Sitzungen** (siehe unten).

Zeilenform (JSON):

- `key`: Sitzungsschlüssel (string)
- `kind`: `main | group | cron | hook | node | other`
- `channel`: `whatsapp | telegram | discord | signal | imessage | webchat | internal | unknown`
- `displayName` (Gruppen‑Anzeigename, falls verfügbar)
- `updatedAt` (ms)
- `sessionId`
- `model`, `contextTokens`, `totalTokens`
- `thinkingLevel`, `verboseLevel`, `systemSent`, `abortedLastRun`
- `sendPolicy` (Sitzungs‑Override, falls gesetzt)
- `lastChannel`, `lastTo`
- `deliveryContext` (normalisiert `{ channel, to, accountId }`, wenn verfügbar)
- `transcriptPath` (Best‑Effort‑Pfad abgeleitet aus Store‑Verzeichnis + sessionId)
- `messages?` (nur wenn `messageLimit > 0`)

## sessions_history

Ruft das Transkript für eine Sitzung ab.

Parameter:

- `sessionKey` (erforderlich; akzeptiert Sitzungsschlüssel oder `sessionId` aus `sessions_list`)
- `limit?: number` maximale Nachrichten (Server begrenzt)
- `includeTools?: boolean` (Standard false)

Verhalten:

- `includeTools=false` filtert `role: "toolResult"`‑Nachrichten.
- Gibt ein Nachrichten‑Array im Roh‑Transkriptformat zurück.
- Bei Übergabe einer `sessionId` löst OpenClaw diese auf den entsprechenden Sitzungsschlüssel auf (Fehler bei fehlenden IDs).

## sessions_send

Sendet eine Nachricht in eine andere Sitzung.

Parameter:

- `sessionKey` (erforderlich; akzeptiert Sitzungsschlüssel oder `sessionId` aus `sessions_list`)
- `message` (erforderlich)
- `timeoutSeconds?: number` (Standard >0; 0 = Fire‑and‑Forget)

Verhalten:

- `timeoutSeconds = 0`: einreihen und `{ runId, status: "accepted" }` zurückgeben.
- `timeoutSeconds > 0`: bis zu N Sekunden auf Abschluss warten und dann `{ runId, status: "ok", reply }` zurückgeben.
- Wenn das Warten abläuft: `{ runId, status: "timeout", error }`. Lauf wird fortgesetzt; rufen Sie `sessions_history` später auf.
- Wenn der Lauf fehlschlägt: `{ runId, status: "error", error }`.
- Ankündigungs‑Läufe werden nach Abschluss des primären Laufs ausgelöst und sind Best‑Effort; `status: "ok"` garantiert nicht, dass die Ankündigung zugestellt wurde.
- Wartet über Gateway `agent.wait` (serverseitig), sodass Reconnects das Warten nicht abbrechen.
- Agent‑zu‑Agent‑Nachrichtenkontext wird für den primären Lauf injiziert.
- Nach Abschluss des primären Laufs führt OpenClaw eine **Reply‑Back‑Schleife** aus:
  - Runde 2+ wechselt zwischen anfragendem und Ziel‑Agenten.
  - Antworten Sie exakt `REPLY_SKIP`, um das Ping‑Pong zu beenden.
  - Maximale Züge sind `session.agentToAgent.maxPingPongTurns` (0–5, Standard 5).
- Sobald die Schleife endet, führt OpenClaw den **Agent‑zu‑Agent‑Ankündigungsschritt** aus (nur Ziel‑Agent):
  - Antworten Sie exakt `ANNOUNCE_SKIP`, um stumm zu bleiben.
  - Jede andere Antwort wird an den Ziel‑Kanal gesendet.
  - Der Ankündigungsschritt umfasst die ursprüngliche Anfrage + Antwort der Runde 1 + letzte Ping‑Pong‑Antwort.

## Kanalfeld

- Für Gruppen ist `channel` der auf dem Sitzungseintrag aufgezeichnete Kanal.
- Für Direktchats wird `channel` aus `lastChannel` abgebildet.
- Für Cron/Hook/Node ist `channel` gleich `internal`.
- Falls fehlend, ist `channel` gleich `unknown`.

## Sicherheit / Sende‑Richtlinie

Richtlinienbasierte Blockierung nach Kanal-/Chat‑Typ (nicht pro Sitzungs‑ID).

```json
{
  "session": {
    "sendPolicy": {
      "rules": [
        {
          "match": { "channel": "discord", "chatType": "group" },
          "action": "deny"
        }
      ],
      "default": "allow"
    }
  }
}
```

Laufzeit‑Override (pro Sitzungseintrag):

- `sendPolicy: "allow" | "deny"` (nicht gesetzt = Konfiguration erben)
- Setzbar über `sessions.patch` oder owner‑only `/send on|off|inherit` (Standalone‑Nachricht).

Durchsetzungspunkte:

- `chat.send` / `agent` (Gateway)
- Auto‑Reply‑Zustelllogik

## sessions_spawn

Startet einen Sub‑Agenten‑Lauf in einer isolierten Sitzung und kündigt das Ergebnis zurück im anfragenden Chat‑Kanal an.

Parameter:

- `task` (erforderlich)
- `label?` (optional; für Logs/UI verwendet)
- `agentId?` (optional; unter einer anderen Agenten‑ID starten, falls erlaubt)
- `model?` (optional; überschreibt das Sub‑Agenten‑Modell; ungültige Werte erzeugen einen Fehler)
- `runTimeoutSeconds?` (Standard 0; wenn gesetzt, bricht den Sub‑Agenten‑Lauf nach N Sekunden ab)
- `cleanup?` (`delete|keep`, Standard `keep`)

Allowlist:

- `agents.list[].subagents.allowAgents`: Liste der Agenten‑IDs, die über `agentId` erlaubt sind (`["*"]` zum Erlauben beliebiger). Standard: nur der anfragende Agent.

Erkennung:

- Verwenden Sie `agents_list`, um zu ermitteln, welche Agenten‑IDs für `sessions_spawn` erlaubt sind.

Verhalten:

- Startet eine neue `agent:<agentId>:subagent:<uuid>`‑Sitzung mit `deliver: false`.
- Sub‑Agenten verwenden standardmäßig den vollständigen Werkzeugsatz **minus Sitzungswerkzeuge** (konfigurierbar über `tools.subagents.tools`).
- Sub‑Agenten dürfen `sessions_spawn` nicht aufrufen (kein Sub‑Agent → Sub‑Agent‑Spawning).
- Immer nicht blockierend: gibt `{ status: "accepted", runId, childSessionKey }` sofort zurück.
- Nach Abschluss führt OpenClaw einen Sub‑Agenten‑**Ankündigungsschritt** aus und postet das Ergebnis in den anfragenden Chat‑Kanal.
- Antworten Sie während des Ankündigungsschritts exakt `ANNOUNCE_SKIP`, um stumm zu bleiben.
- Ankündigungsantworten werden auf `Status`/`Result`/`Notes` normalisiert; `Status` stammt aus dem Laufzeitergebnis (nicht aus dem Modelltext).
- Sub‑Agenten‑Sitzungen werden nach `agents.defaults.subagents.archiveAfterMinutes` automatisch archiviert (Standard: 60).
- Ankündigungsantworten enthalten eine Statistikzeile (Laufzeit, Tokens, sessionKey/sessionId, Transkriptpfad und optionale Kosten).

## Sandbox‑Sitzungssichtbarkeit

Sitzungen in einer Sandbox können Sitzungswerkzeuge verwenden, sehen standardmäßig jedoch nur Sitzungen, die sie über `sessions_spawn` gespawnt haben.

Konfiguration:

```json5
{
  agents: {
    defaults: {
      sandbox: {
        // default: "spawned"
        sessionToolsVisibility: "spawned", // or "all"
      },
    },
  },
}
```
