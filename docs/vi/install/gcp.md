---
summary: "Chạy OpenClaw Gateway 24/7 trên VM GCP Compute Engine (Docker) với trạng thái bền vững"
read_when:
  - Bạn muốn OpenClaw chạy 24/7 trên GCP
  - Bạn muốn một Gateway luôn hoạt động, cấp độ production trên VM của riêng bạn
  - Bạn muốn toàn quyền kiểm soát tính bền vững, các binary và hành vi khởi động lại
title: "GCP"
x-i18n:
  source_path: install/gcp.md
  source_hash: abb236dd421505d3
  provider: openai
  model: gpt-5.2-chat-latest
  workflow: v1
  generated_at: 2026-02-08T07:07:42Z
---

# OpenClaw trên GCP Compute Engine (Docker, Hướng dẫn VPS Production)

## Mục tiêu

Chạy một OpenClaw Gateway bền vững trên VM GCP Compute Engine bằng Docker, với trạng thái lâu dài, các binary được đóng gói sẵn và hành vi khởi động lại an toàn.

Nếu bạn muốn “OpenClaw 24/7 với ~$5-12/tháng”, đây là một thiết lập đáng tin cậy trên Google Cloud.  
Chi phí thay đổi theo loại máy và khu vực; hãy chọn VM nhỏ nhất đáp ứng được tải của bạn và nâng cấp nếu gặp OOM.

## Chúng ta đang làm gì (nói đơn giản)?

- Tạo một dự án GCP và bật billing
- Tạo một VM Compute Engine
- Cài Docker (môi trường chạy ứng dụng tách biệt)
- Khởi động OpenClaw Gateway trong Docker
- Lưu trữ bền vững `~/.openclaw` + `~/.openclaw/workspace` trên host (tồn tại qua các lần khởi động lại/xây dựng lại)
- Truy cập Control UI từ laptop của bạn qua SSH tunnel

Gateway có thể được truy cập qua:

- Chuyển tiếp cổng SSH từ laptop của bạn
- Mở cổng trực tiếp nếu bạn tự quản lý firewall và token

Hướng dẫn này dùng Debian trên GCP Compute Engine.  
Ubuntu cũng hoạt động; hãy ánh xạ các gói tương ứng.  
Đối với luồng Docker chung, xem [Docker](/install/docker).

---

## Lộ trình nhanh (cho người đã có kinh nghiệm)

1. Tạo dự án GCP + bật Compute Engine API
2. Tạo VM Compute Engine (e2-small, Debian 12, 20GB)
3. SSH vào VM
4. Cài Docker
5. Clone repository OpenClaw
6. Tạo các thư mục bền vững trên host
7. Cấu hình `.env` và `docker-compose.yml`
8. Đóng gói các binary cần thiết, build và khởi chạy

---

## Những gì bạn cần

- Tài khoản GCP (free tier đủ điều kiện cho e2-micro)
- gcloud CLI đã cài (hoặc dùng Cloud Console)
- Quyền SSH từ laptop của bạn
- Biết cơ bản về SSH + copy/paste
- ~20–30 phút
- Docker và Docker Compose
- Thông tin xác thực model
- Thông tin xác thực nhà cung cấp (tùy chọn)
  - WhatsApp QR
  - Telegram bot token
  - Gmail OAuth

---

## 1) Cài gcloud CLI (hoặc dùng Console)

**Tùy chọn A: gcloud CLI** (khuyến nghị cho tự động hóa)

Cài từ https://cloud.google.com/sdk/docs/install

Khởi tạo và xác thực:

```bash
gcloud init
gcloud auth login
```

**Tùy chọn B: Cloud Console**

Tất cả các bước đều có thể thực hiện qua giao diện web tại https://console.cloud.google.com

---

## 2) Tạo dự án GCP

**CLI:**

```bash
gcloud projects create my-openclaw-project --name="OpenClaw Gateway"
gcloud config set project my-openclaw-project
```

Bật billing tại https://console.cloud.google.com/billing (bắt buộc cho Compute Engine).

Bật Compute Engine API:

```bash
gcloud services enable compute.googleapis.com
```

**Console:**

1. Vào IAM & Admin > Create Project
2. Đặt tên và tạo
3. Bật billing cho dự án
4. Vào APIs & Services > Enable APIs > tìm “Compute Engine API” > Enable

---

## 3) Tạo VM

**Loại máy:**

| Type     | Specs                     | Cost                   | Notes                  |
| -------- | ------------------------- | ---------------------- | ---------------------- |
| e2-small | 2 vCPU, 2GB RAM           | ~$12/tháng             | Khuyến nghị            |
| e2-micro | 2 vCPU (chia sẻ), 1GB RAM | Đủ điều kiện free tier | Có thể OOM khi tải cao |

**CLI:**

```bash
gcloud compute instances create openclaw-gateway \
  --zone=us-central1-a \
  --machine-type=e2-small \
  --boot-disk-size=20GB \
  --image-family=debian-12 \
  --image-project=debian-cloud
```

**Console:**

1. Vào Compute Engine > VM instances > Create instance
2. Tên: `openclaw-gateway`
3. Region: `us-central1`, Zone: `us-central1-a`
4. Machine type: `e2-small`
5. Boot disk: Debian 12, 20GB
6. Create

---

## 4) SSH vào VM

**CLI:**

```bash
gcloud compute ssh openclaw-gateway --zone=us-central1-a
```

**Console:**

Nhấn nút “SSH” cạnh VM của bạn trong bảng điều khiển Compute Engine.

Lưu ý: Việc đồng bộ SSH key có thể mất 1–2 phút sau khi tạo VM. Nếu bị từ chối kết nối, hãy chờ và thử lại.

---

## 5) Cài Docker (trên VM)

```bash
sudo apt-get update
sudo apt-get install -y git curl ca-certificates
curl -fsSL https://get.docker.com | sudo sh
sudo usermod -aG docker $USER
```

Đăng xuất và đăng nhập lại để thay đổi nhóm có hiệu lực:

```bash
exit
```

Sau đó SSH lại:

```bash
gcloud compute ssh openclaw-gateway --zone=us-central1-a
```

Kiểm tra:

```bash
docker --version
docker compose version
```

---

## 6) Clone repository OpenClaw

```bash
git clone https://github.com/openclaw/openclaw.git
cd openclaw
```

Hướng dẫn này giả định bạn sẽ build một image tùy chỉnh để đảm bảo tính bền vững của các binary.

---

## 7) Tạo các thư mục bền vững trên host

Container Docker là tạm thời.  
Mọi trạng thái tồn tại lâu dài phải nằm trên host.

```bash
mkdir -p ~/.openclaw
mkdir -p ~/.openclaw/workspace
```

---

## 8) Cấu hình biến môi trường

Tạo `.env` ở thư mục gốc của repository.

```bash
OPENCLAW_IMAGE=openclaw:latest
OPENCLAW_GATEWAY_TOKEN=change-me-now
OPENCLAW_GATEWAY_BIND=lan
OPENCLAW_GATEWAY_PORT=18789

OPENCLAW_CONFIG_DIR=/home/$USER/.openclaw
OPENCLAW_WORKSPACE_DIR=/home/$USER/.openclaw/workspace

GOG_KEYRING_PASSWORD=change-me-now
XDG_CONFIG_HOME=/home/node/.openclaw
```

Tạo secret mạnh:

```bash
openssl rand -hex 32
```

**Không commit file này.**

---

## 9) Cấu hình Docker Compose

Tạo hoặc cập nhật `docker-compose.yml`.

```yaml
services:
  openclaw-gateway:
    image: ${OPENCLAW_IMAGE}
    build: .
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - HOME=/home/node
      - NODE_ENV=production
      - TERM=xterm-256color
      - OPENCLAW_GATEWAY_BIND=${OPENCLAW_GATEWAY_BIND}
      - OPENCLAW_GATEWAY_PORT=${OPENCLAW_GATEWAY_PORT}
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN}
      - GOG_KEYRING_PASSWORD=${GOG_KEYRING_PASSWORD}
      - XDG_CONFIG_HOME=${XDG_CONFIG_HOME}
      - PATH=/home/linuxbrew/.linuxbrew/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    volumes:
      - ${OPENCLAW_CONFIG_DIR}:/home/node/.openclaw
      - ${OPENCLAW_WORKSPACE_DIR}:/home/node/.openclaw/workspace
    ports:
      # Recommended: keep the Gateway loopback-only on the VM; access via SSH tunnel.
      # To expose it publicly, remove the `127.0.0.1:` prefix and firewall accordingly.
      - "127.0.0.1:${OPENCLAW_GATEWAY_PORT}:18789"

      # Optional: only if you run iOS/Android nodes against this VM and need Canvas host.
      # If you expose this publicly, read /gateway/security and firewall accordingly.
      # - "18793:18793"
    command:
      [
        "node",
        "dist/index.js",
        "gateway",
        "--bind",
        "${OPENCLAW_GATEWAY_BIND}",
        "--port",
        "${OPENCLAW_GATEWAY_PORT}",
      ]
```

---

## 10) Đóng gói các binary cần thiết vào image (quan trọng)

Cài binary bên trong container đang chạy là một cái bẫy.  
Bất cứ thứ gì cài lúc runtime sẽ bị mất khi khởi động lại.

Tất cả các binary bên ngoài mà Skills yêu cầu phải được cài tại thời điểm build image.

Các ví dụ dưới đây chỉ minh họa ba binary phổ biến:

- `gog` cho truy cập Gmail
- `goplaces` cho Google Places
- `wacli` cho WhatsApp

Đây chỉ là ví dụ, không phải danh sách đầy đủ.  
Bạn có thể cài bao nhiêu binary tùy ý theo cùng một mẫu.

Nếu sau này bạn thêm Skills mới phụ thuộc vào các binary bổ sung, bạn phải:

1. Cập nhật Dockerfile
2. Rebuild image
3. Khởi động lại container

**Ví dụ Dockerfile**

```dockerfile
FROM node:22-bookworm

RUN apt-get update && apt-get install -y socat && rm -rf /var/lib/apt/lists/*

# Example binary 1: Gmail CLI
RUN curl -L https://github.com/steipete/gog/releases/latest/download/gog_Linux_x86_64.tar.gz \
  | tar -xz -C /usr/local/bin && chmod +x /usr/local/bin/gog

# Example binary 2: Google Places CLI
RUN curl -L https://github.com/steipete/goplaces/releases/latest/download/goplaces_Linux_x86_64.tar.gz \
  | tar -xz -C /usr/local/bin && chmod +x /usr/local/bin/goplaces

# Example binary 3: WhatsApp CLI
RUN curl -L https://github.com/steipete/wacli/releases/latest/download/wacli_Linux_x86_64.tar.gz \
  | tar -xz -C /usr/local/bin && chmod +x /usr/local/bin/wacli

# Add more binaries below using the same pattern

WORKDIR /app
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml .npmrc ./
COPY ui/package.json ./ui/package.json
COPY scripts ./scripts

RUN corepack enable
RUN pnpm install --frozen-lockfile

COPY . .
RUN pnpm build
RUN pnpm ui:install
RUN pnpm ui:build

ENV NODE_ENV=production

CMD ["node","dist/index.js"]
```

---

## 11) Build và khởi chạy

```bash
docker compose build
docker compose up -d openclaw-gateway
```

Kiểm tra các binary:

```bash
docker compose exec openclaw-gateway which gog
docker compose exec openclaw-gateway which goplaces
docker compose exec openclaw-gateway which wacli
```

Kết quả mong đợi:

```
/usr/local/bin/gog
/usr/local/bin/goplaces
/usr/local/bin/wacli
```

---

## 12) Xác minh Gateway

```bash
docker compose logs -f openclaw-gateway
```

Thành công:

```
[gateway] listening on ws://0.0.0.0:18789
```

---

## 13) Truy cập từ laptop của bạn

Tạo SSH tunnel để chuyển tiếp cổng Gateway:

```bash
gcloud compute ssh openclaw-gateway --zone=us-central1-a -- -L 18789:127.0.0.1:18789
```

Mở trong trình duyệt:

`http://127.0.0.1:18789/`

Dán gateway token của bạn.

---

## Những gì được lưu ở đâu (nguồn chân lý)

OpenClaw chạy trong Docker, nhưng Docker không phải là nguồn chân lý.  
Mọi trạng thái tồn tại lâu dài phải sống sót qua khởi động lại, build lại và reboot.

| Thành phần           | Vị trí                            | Cơ chế lưu trữ bền vững | Ghi chú                        |
| -------------------- | --------------------------------- | ----------------------- | ------------------------------ |
| Cấu hình Gateway     | `/home/node/.openclaw/`           | Gắn volume host         | Bao gồm `openclaw.json`, token |
| Hồ sơ xác thực model | `/home/node/.openclaw/`           | Gắn volume host         | OAuth token, API key           |
| Cấu hình Skill       | `/home/node/.openclaw/skills/`    | Gắn volume host         | Trạng thái cấp Skill           |
| Workspace agent      | `/home/node/.openclaw/workspace/` | Gắn volume host         | Code và artifact của agent     |
| Phiên WhatsApp       | `/home/node/.openclaw/`           | Gắn volume host         | Giữ đăng nhập QR               |
| Keyring Gmail        | `/home/node/.openclaw/`           | Volume host + mật khẩu  | Yêu cầu `GOG_KEYRING_PASSWORD` |
| Binary bên ngoài     | `/usr/local/bin/`                 | Docker image            | Phải được đóng gói lúc build   |
| Node runtime         | Filesystem container              | Docker image            | Rebuild mỗi lần build image    |
| Gói hệ điều hành     | Filesystem container              | Docker image            | Không cài lúc runtime          |
| Docker container     | Tạm thời                          | Có thể restart          | An toàn khi xóa                |

---

## Cập nhật

Để cập nhật OpenClaw trên VM:

```bash
cd ~/openclaw
git pull
docker compose build
docker compose up -d
```

---

## Xử lý sự cố

**SSH connection refused**

Việc đồng bộ SSH key có thể mất 1–2 phút sau khi tạo VM. Hãy chờ và thử lại.

**Vấn đề OS Login**

Kiểm tra hồ sơ OS Login của bạn:

```bash
gcloud compute os-login describe-profile
```

Đảm bảo tài khoản của bạn có quyền IAM cần thiết (Compute OS Login hoặc Compute OS Admin Login).

**Hết bộ nhớ (OOM)**

Nếu dùng e2-micro và gặp OOM, hãy nâng cấp lên e2-small hoặc e2-medium:

```bash
# Stop the VM first
gcloud compute instances stop openclaw-gateway --zone=us-central1-a

# Change machine type
gcloud compute instances set-machine-type openclaw-gateway \
  --zone=us-central1-a \
  --machine-type=e2-small

# Start the VM
gcloud compute instances start openclaw-gateway --zone=us-central1-a
```

---

## Service accounts (thực hành bảo mật tốt nhất)

Với mục đích cá nhân, tài khoản người dùng mặc định của bạn là đủ.

Đối với tự động hóa hoặc pipeline CI/CD, hãy tạo một service account riêng với quyền tối thiểu:

1. Tạo service account:

   ```bash
   gcloud iam service-accounts create openclaw-deploy \
     --display-name="OpenClaw Deployment"
   ```

2. Cấp vai trò Compute Instance Admin (hoặc vai trò tùy chỉnh hẹp hơn):
   ```bash
   gcloud projects add-iam-policy-binding my-openclaw-project \
     --member="serviceAccount:openclaw-deploy@my-openclaw-project.iam.gserviceaccount.com" \
     --role="roles/compute.instanceAdmin.v1"
   ```

Tránh dùng vai trò Owner cho tự động hóa. Áp dụng nguyên tắc đặc quyền tối thiểu.

Xem https://cloud.google.com/iam/docs/understanding-roles để biết chi tiết về vai trò IAM.

---

## Bước tiếp theo

- Thiết lập các kênh nhắn tin: [Channels](/channels)
- Ghép nối thiết bị cục bộ làm node: [Nodes](/nodes)
- Cấu hình Gateway: [Gateway configuration](/gateway/configuration)
