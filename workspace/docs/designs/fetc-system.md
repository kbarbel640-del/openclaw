# FETC é é€šé›»æ”¶ç³»çµ±è¨­è¨ˆæ–‡æª”

> åˆ†ææ—¥æœŸï¼š2026-01-28
> ç‹€æ…‹ï¼š**ğŸŸ¢ ä»åœ¨ä½¿ç”¨**

---

## 1. ç³»çµ±æ¦‚è¦½

### 1.1 å°ˆæ¡ˆçµ„æˆ

| å°ˆæ¡ˆ | è·¯å¾‘ | é¡å‹ | ç‹€æ…‹ |
|------|------|------|------|
| fetc | `~/Documents/fetc/` | Python çˆ¬èŸ² + æ‰¹æ¬¡è™•ç† | ğŸŸ¢ æ¯æ—¥åŸ·è¡Œä¸­ |
| fetc_webapp | `~/Documents/fetc_webapp/` | ç´”å‰ç«¯æŸ¥è©¢ä»‹é¢ | ğŸŸ¢ é…å¥—ä½¿ç”¨ä¸­ |

### 1.2 å•†æ¥­ç”¨é€”

**å•é¡Œ**ï¼šç§Ÿè»Šå…¬å¸æœ‰å¤šå°è»Šè¼›ï¼Œæ¯æœˆéœ€æ‰‹å‹•æŸ¥è©¢åœè»Šè²»å’Œéè·¯è²»
**è§£æ³•**ï¼šè‡ªå‹•åŒ–çˆ¬èŸ²æ¯æ—¥æ”¶é›†è³‡æ–™ï¼Œçµ±ä¸€å„²å­˜åˆ°é›²ç«¯è³‡æ–™åº«

**æ•ˆç›Šè¨ˆç®—**ï¼š
- äººå·¥ï¼š5åˆ†é˜/è»Š Ã— 20å° Ã— 12æœˆ = 20å°æ™‚/å¹´
- è‡ªå‹•åŒ–ï¼š1åˆ†é˜/è»Š Ã— 20å° Ã— 12æœˆ = 4å°æ™‚/å¹´
- **ç¯€çœ 80% äººåŠ›**

---

## 2. æŠ€è¡“æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FETC ç³»çµ±æ¶æ§‹                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Cron Job  â”‚â”€â”€â”€â”€â–¶â”‚ daily_batch â”‚â”€â”€â”€â”€â–¶â”‚  main.py  â”‚ â”‚
â”‚  â”‚  (06:00 AM) â”‚     â”‚    .py      â”‚     â”‚  (çˆ¬èŸ²)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚       â”‚
â”‚                                                 â–¼       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚fetc_webapp  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Supabase  â”‚  â”‚
â”‚  â”‚ (å‰ç«¯æŸ¥è©¢)  â”‚                        â”‚PostgreSQL â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.1 æ ¸å¿ƒæŠ€è¡“æ£§

| å±¤ç´š | æŠ€è¡“ | ç”¨é€” |
|------|------|------|
| çˆ¬èŸ² | Selenium + Chrome | ç¶²é è‡ªå‹•åŒ– |
| OCR | Tesseract + PIL | é©—è­‰ç¢¼è­˜åˆ¥ |
| è³‡æ–™åº« | Supabase (PostgreSQL) | é›²ç«¯å„²å­˜ |
| å»é‡ | UUID5 | é˜²æ­¢é‡è¤‡è³‡æ–™ |
| å‰ç«¯ | ç´” HTML/JS | è³‡æ–™æŸ¥è©¢ |
| å®¹å™¨ | Docker Compose | éƒ¨ç½²åŸ·è¡Œ |

### 2.2 è³‡æ–™æ¨¡å‹

**fees è¡¨çµæ§‹**ï¼š
```sql
- fee_id (UUID)          -- ä¸»éµï¼ŒUUID5 ç”Ÿæˆ
- license_plate_number   -- è»Šç‰Œè™Ÿç¢¼
- fee_type               -- toll/street_parking/short_term_parking
- fee_amount             -- é‡‘é¡
- occurred_at            -- ç™¼ç”Ÿæ™‚é–“
- date_only              -- æ™‚é–“ç²¾åº¦æ¨™è¨˜
```

---

## 3. çˆ¬èŸ²æµç¨‹

### 3.1 ä¸‰éšæ®µæ¨¡çµ„åŒ–æ¶æ§‹

```
Login Module â”€â”€â–¶ Parking Module â”€â”€â–¶ Toll Module
    â”‚                  â”‚                 â”‚
    â–¼                  â–¼                 â–¼
é›™é‡ç™»å…¥æ–¹å¼      åœè»Šè²»+è‡¨åœè²»       éè·¯è²»
(æœƒå“¡/è¨ªå®¢)      (è·¯é‚Š/è‡¨æ™‚)        (ETC)
```

### 3.2 ç™»å…¥æ–¹å¼å·®ç•°

| æ¨¡å¼ | éœ€è¦è³‡è¨Š | è‡¨åœç²¾åº¦ | åœè»Šè²»ç²¾åº¦ |
|------|----------|----------|------------|
| Guest | è»Šç‰Œ + çµ±ç·¨/èº«åˆ†è­‰ | åƒ…æ—¥æœŸ | åƒ…æ—¥æœŸ |
| Member | å¸³è™Ÿ + å¯†ç¢¼ | ç²¾ç¢ºåˆ°åˆ†é˜ | åƒ…æ—¥æœŸ |

### 3.3 UUID å»é‡æ©Ÿåˆ¶

```python
hash_string = f"{è»Šç‰Œ}-{æ—¥æœŸ}-{è²»ç”¨é¡å‹}-{ç¥¨è™Ÿ}"
fee_uuid = uuid5(NAMESPACE_DNS, hash_string)
```

**å¥½è™•**ï¼šç›¸åŒè³‡æ–™ â†’ ç›¸åŒ UUID â†’ å¤©ç„¶å»é‡

---

## 4. ä½¿ç”¨ç‹€æ…‹è©•ä¼°

### 4.1 æ´»èºåº¦æŒ‡æ¨™

| æŒ‡æ¨™ | æ•¸å€¼ | åˆ¤æ–· |
|------|------|------|
| æœ€æ–°åŸ·è¡Œ | 2026-01-28 06:00 | âœ… ä»Šå¤© |
| Log æª”æ¡ˆæ•¸ | 81 å€‹ | âœ… æŒçºŒåŸ·è¡Œ |
| Git commits | 4 å€‹ | ç©©å®šç‰ˆæœ¬ |
| Cron æ’ç¨‹ | æ¯æ—¥ 06:00 | âœ… è‡ªå‹•åŒ–ä¸­ |

### 4.2 ç•¶å‰å•é¡Œ

```
unable to get image 'fetc-fetc-batch': Cannot connect to the Docker daemon
```

**åŸå› **ï¼šDocker Desktop æœªå•Ÿå‹•
**å½±éŸ¿**ï¼šçˆ¬èŸ²ç„¡æ³•åŸ·è¡Œ
**å»ºè­°**ï¼šç¢ºä¿ Docker Desktop é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•

---

## 5. å¯é‡ç”¨ä»£ç¢¼åˆ†æ

### 5.1 æ¨è–¦èƒå–åˆ° lib/

#### ğŸ“¦ æ™‚é–“è§£æå™¨ (`lib/datetime_parser.py`)

```python
def parse_datetime_to_utc(datetime_str, current_year=None):
    """
    æ”¯æ´æ ¼å¼ï¼š
    - "09/08(ä¸€) 09:12" â†’ è‡¨åœè©³ç´°æ™‚é–“
    - "09/09(äºŒ)" â†’ è‡¨åœåƒ…æ—¥æœŸ
    - "2024-08-28" â†’ æ¨™æº–æ—¥æœŸ
    - "2025/09/04 22:29" â†’ æœƒå“¡éè·¯è²»
    - "2025/09/04" â†’ è·¯é‚Šåœè»Šè²»
    - "08/28" â†’ æœˆ/æ—¥æ ¼å¼
    """
```

**åƒ¹å€¼**ï¼šè™•ç†å°ç£å„ç¨®æ™‚é–“æ ¼å¼çš„é€šç”¨å‡½æ•¸

#### ğŸ“¦ UUID5 å»é‡ç”Ÿæˆå™¨ (`lib/uuid_dedup.py`)

```python
def generate_fee_uuid(entity_type, *key_parts):
    """
    åŸºæ–¼æ¥­å‹™éµç”Ÿæˆç¢ºå®šæ€§ UUID
    ç”¨é€”ï¼šä»»ä½•éœ€è¦å†ªç­‰å¯«å…¥çš„å ´æ™¯
    """
    hash_string = "-".join(str(p) for p in key_parts)
    return str(uuid.uuid5(uuid.NAMESPACE_DNS, hash_string))
```

**åƒ¹å€¼**ï¼šé€šç”¨çš„å†ªç­‰å¯«å…¥æ¨¡å¼

#### ğŸ“¦ Supabase é€£æ¥+èªè­‰ (`lib/supabase_client.py`)

```python
def create_authenticated_client(url, key, email, password):
    """
    å»ºç«‹å·²é€šé RLS èªè­‰çš„ Supabase å®¢æˆ¶ç«¯
    """
```

**åƒ¹å€¼**ï¼šæ¨™æº–åŒ– Supabase é€£æ¥æ¨¡å¼

### 5.2 ä¸å»ºè­°èƒå–

| ä»£ç¢¼ | åŸå›  |
|------|------|
| Selenium çˆ¬èŸ²é‚è¼¯ | å¤ªç‰¹å®šæ–¼ FETC ç¶²ç«™ |
| é©—è­‰ç¢¼ OCR | ä¾è³´ç‰¹å®šç¶²ç«™æ ¼å¼ |
| è¡¨æ ¼è§£æ | HTML çµæ§‹é«˜åº¦ç‰¹å®š |

---

## 6. æ­¸æª”å»ºè­°

### 6.1 çµè«–

| å°ˆæ¡ˆ | å¯æ­¸æª”ï¼Ÿ | åŸå›  |
|------|----------|------|
| fetc | âŒ å¦ | ä»æ¯æ—¥åŸ·è¡Œï¼Œæ¥­å‹™ä¾è³´ |
| fetc_webapp | âŒ å¦ | æ˜¯ fetc çš„æŸ¥è©¢ä»‹é¢ |

### 6.2 å¾ŒçºŒè¡Œå‹•

1. **ä¿®å¾© Docker å•é¡Œ**
   - ç¢ºä¿ Docker Desktop é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•
   - æˆ–æ”¹ç”¨é Docker æ–¹å¼ç›´æ¥åŸ·è¡Œ

2. **ä»£ç¢¼èƒå–**
   - æ™‚é–“è§£æå™¨ â†’ `lib/datetime_parser.py`
   - UUID ç”Ÿæˆå™¨ â†’ `lib/uuid_dedup.py`
   - Supabase client â†’ `lib/supabase_client.py`

3. **æ–‡æª”æ›´æ–°**
   - å°‡æ­¤æ–‡æª”åŠ å…¥ fetc repo
   - æ›´æ–° FETC README èªªæ˜ Docker ä¾è³´

---

## 7. ç³»çµ±çµ±è¨ˆ

```
fetc/
â”œâ”€â”€ main.py           2,414 è¡Œ (æ ¸å¿ƒçˆ¬èŸ²)
â”œâ”€â”€ daily_batch.py      ~400 è¡Œ (æ‰¹æ¬¡è™•ç†)
â”œâ”€â”€ logs/                81 å€‹æª”æ¡ˆ
â”œâ”€â”€ æŠ€è¡“ï¼šPython + Selenium + Supabase
â””â”€â”€ åŸ·è¡Œï¼šæ¯æ—¥ 06:00 cron

fetc_webapp/
â”œâ”€â”€ index.html        ~700 è¡Œ (å–®é æ‡‰ç”¨)
â””â”€â”€ æŠ€è¡“ï¼šç´”å‰ç«¯ + Supabase REST API
```

---

*æ–‡æª”ç”Ÿæˆï¼š2026-01-28 by Clawd*
