---
name: media-ingestion
description: "Unified media processing pipeline - Perception layer core"
metadata:
  {
    "openclaw":
      {
        "emoji": "ğŸ“·",
        "events": ["message:received"],
        "priority": 50,
        "install": [{ "id": "workspace", "kind": "workspace", "label": "Media ingestion hook" }],
      },
  }
---

# Media Ingestion Hook

çµ±ä¸€åª’é«”è™•ç†ç®¡é“ â€” æ„ŸçŸ¥å±¤æ ¸å¿ƒçµ„ä»¶ã€‚

## æ¦‚è¿°

ç„¡è«–åª’é«”ä¾†è‡ªå“ªå€‹ channelï¼Œéƒ½çµ±ä¸€è™•ç†ä¸¦å­˜æ”¾åˆ° `/app/media/{channel}/`ã€‚

## æµç¨‹

```
æ”¶åˆ°åª’é«”è¨Šæ¯
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. è­˜åˆ¥ä¾†æº channel                      â”‚
â”‚     - telegram / line / discord / web    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ä¸‹è¼‰åˆ°çµ±ä¸€ä½ç½®                         â”‚
â”‚     /app/media/{channel}/{timestamp}_{id}â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. åˆ¤æ–·åª’é«”é¡å‹ä¸¦è™•ç†                     â”‚
â”‚     - image: OCR + æè¿°                  â”‚
â”‚     - audio: è½‰æ–‡å­— (STT)                â”‚
â”‚     - video: å§”æ´¾çµ¦ video-processor      â”‚
â”‚     - document: æå–æ–‡å­—/metadata        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. æ³¨å…¥è™•ç†çµæœåˆ° event context          â”‚
â”‚     event.payload.media = {...}          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ³¨å…¥æ¬„ä½

```javascript
event.payload.media = {
  // åŸºæœ¬è³‡è¨Š
  type: "image" | "audio" | "video" | "document",
  channel: "telegram" | "line" | "discord",
  originalPath: "/app/media/telegram/2026-02-06_photo_123.jpg",

  // è™•ç†çµæœï¼ˆæ ¹æ“šé¡å‹ä¸åŒï¼‰
  processed: {
    // åœ–ç‰‡
    description: "ä¸€å¼µæ‰‹å¯«çš„å·¥ä½œæ¸…å–®...",
    ocrText: "1. å®Œæˆå ±å‘Š\n2. å›è¦†éƒµä»¶...",

    // éŸ³è¨Š
    transcript: "ä»Šå¤©é–‹æœƒè¨è«–äº†...",
    duration: 30.5,

    // è¦–é »ï¼ˆç”± video-processor è™•ç†ï¼‰
    videoProcessed: {...},

    // æ–‡ä»¶
    documentText: "åˆç´„å…§å®¹...",
    pageCount: 5,
  },

  // çµ±ä¸€çš„æç¤ºæ–‡å­—ï¼ˆçµ¦ Agent çœ‹ï¼‰
  hint: "[åœ–ç‰‡: æ‰‹å¯«å·¥ä½œæ¸…å–®ï¼ŒOCR å·²æå– 15 è¡Œæ–‡å­—]"
};
```

## ä¾è³´

| æœå‹™               | ç”¨é€”                      | ç«¯å£  |
| ------------------ | ------------------------- | ----- |
| exec-bridge        | åŸ·è¡Œè™•ç†å‘½ä»¤              | 18793 |
| telegram-userbot   | ä¸‹è¼‰ Telegram åª’é«”        | 18790 |
| Anthropic API      | åœ–ç‰‡æè¿° (claude-3-haiku) | -     |
| OpenAI Whisper API | éŸ³è¨Šè½‰æ–‡å­—                | -     |

## ç’°å¢ƒè®Šæ•¸

```bash
MEDIA_ROOT=/app/media          # åª’é«”æ ¹ç›®éŒ„
ANTHROPIC_API_KEY=...          # åœ–ç‰‡æè¿° API
OPENAI_API_KEY=...             # Whisper APIï¼ˆå¯é¸ï¼‰
```

## ä½¿ç”¨ç¯„ä¾‹

### Agent æ”¶åˆ°åœ–ç‰‡

```
ç”¨æˆ¶ç™¼é€ä¸€å¼µåœ–ç‰‡

Agent æ”¶åˆ°çš„ context åŒ…å«ï¼š
- event.payload.media.hint = "[åœ–ç‰‡: å·¥ä½œé€²åº¦è¡¨æ ¼ï¼Œå·² OCR]"
- event.payload.media.processed.ocrText = "ä»»å‹™1: å®Œæˆ\nä»»å‹™2: é€²è¡Œä¸­..."

Agent å¯ä»¥ç›´æ¥å¼•ç”¨ OCR çµæœå›è¦†ç”¨æˆ¶
```

## èˆ‡å…¶ä»– Hook çš„é—œä¿‚

| Hook            | å„ªå…ˆç´š | é—œä¿‚         |
| --------------- | ------ | ------------ |
| media-ingestion | 50     | å…ˆè™•ç†åª’é«”   |
| video-processor | 100    | æ¥æ”¶è¦–é »å§”æ´¾ |
| time-tunnel     | 200    | è¨˜éŒ„åª’é«”äº‹ä»¶ |

## é©—æ”¶æ¨™æº–

- [ ] Telegram åœ–ç‰‡è‡ªå‹•ä¸‹è¼‰åˆ° `/app/media/telegram/`
- [ ] LINE åœ–ç‰‡è‡ªå‹•ä¸‹è¼‰åˆ° `/app/media/line/`
- [ ] åœ–ç‰‡è‡ªå‹•ç”Ÿæˆæè¿°å’Œ OCR
- [ ] Agent èƒ½åœ¨ context ä¸­çœ‹åˆ° `media.hint`
