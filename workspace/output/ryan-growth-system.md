# 🏦 Ryan 成長銀行 — Discord 互動系統設計

> 讓 Ryan 透過 Discord 跟無極互動，在遊戲中學習、在學習中成長。

---

## 1. 📂 頻道結構設計

### 分類：🏫 學習區
| 頻道 | 用途 |
|------|------|
| `#每日打卡` | 每天記錄學了什麼（寫一句話就好），打卡得 XP |
| `#讀書筆記` | 讀了書/看了影片，寫心得分享 |
| `#英文角` | 每日一個英文單字/句子練習 |
| `#問問無極` | 任何問題都可以問，無極會回答＋追問引導思考 |

### 分類：🎮 遊戲區
| 頻道 | 用途 |
|------|------|
| `#寶可夢大廳` | PTCG 相關互動的主頻道（猜卡、對戰、知識） |
| `#每日寶可夢` | 無極每天推送一隻寶可夢知識卡 |
| `#模擬對戰` | 文字回合制寶可夢對戰 |
| `#小遊戲` | 猜謎、數學挑戰、腦筋急轉彎等 |

### 分類：📋 任務區
| 頻道 | 用途 |
|------|------|
| `#每日任務` | 每天 3 個小任務（學習+生活+創意各一） |
| `#每週挑戰` | 較大的挑戰，完成有大獎勵 |
| `#任務提交` | 上傳完成證據（截圖/文字/照片） |

### 分類：🏆 成就區
| 頻道 | 用途 |
|------|------|
| `#成就牆` | 自動公告升級、里程碑、獲得徽章 |
| `#收藏展示` | 展示寶可夢卡牌收藏 |
| `#排行榜` | XP 排行（未來可多人） |

---

## 2. ⭐ XP 計算邏輯

### 2.1 獲得 XP 的行為

| 行為 | XP | 每日上限 | 說明 |
|------|-----|---------|------|
| 發訊息 | +2 | 20/天 | 防灌水，60 秒冷卻 |
| 每日打卡 | +15 | 1 次/天 | 在 `#每日打卡` 發訊息 |
| 連續打卡加成 | +5×天數 | — | 連續 7 天 = +35 額外 |
| 完成每日任務 | +20/任務 | 3 任務/天 | 每個任務獨立計算 |
| 完成每週挑戰 | +100 | 1 次/週 | 大挑戰大獎勵 |
| 讀書筆記 | +25 | 2 次/天 | 要寫超過 30 字才算 |
| 英文練習 | +10 | 1 次/天 | 回答英文角的題目 |
| 猜卡遊戲答對 | +15 | — | 每次猜對都算 |
| 模擬對戰獲勝 | +30 | — | 完成一場對戰 |
| 模擬對戰參與 | +10 | — | 輸了也有 |
| 問問無極 | +5 | 5 次/天 | 鼓勵提問 |

### 2.2 等級系統（Lv.1 → Lv.50）

**公式**：`所需 XP = 50 × Level²`

| 等級 | 累計 XP | 稱號 |
|------|---------|------|
| 1 | 0 | 🥚 寶可夢蛋 |
| 5 | 1,250 | 🐛 小小訓練師 |
| 10 | 5,000 | ⚡ 初級訓練師 |
| 15 | 11,250 | 🔥 進階訓練師 |
| 20 | 20,000 | 💧 菁英訓練師 |
| 25 | 31,250 | 🌿 資深訓練師 |
| 30 | 45,000 | 🌟 道館館主 |
| 35 | 61,250 | 💎 四天王 |
| 40 | 80,000 | 👑 冠軍 |
| 45 | 101,250 | 🏆 傳說訓練師 |
| 50 | 125,000 | 🌈 寶可夢大師 |

> 預估：認真互動每天約 100-150 XP，到 Lv.10 約需 5-7 週，節奏適中。

### 2.3 獎勵機制

**升級獎勵**（每次升級）：
- 🎉 成就牆自動公告
- 解鎖新稱號（每 5 級一個）
- 獲得「寶可夢球」×1（用於收藏系統抽卡）

**里程碑獎勵**：
| 里程碑 | 獎勵 |
|--------|------|
| Lv.10 首次達成 | 🎁 選一隻最愛寶可夢當「夥伴」，顯示在個人檔案 |
| Lv.20 | 🎁 解鎖「自訂對戰牌組」功能 |
| Lv.30 | 🎁 獲得「道館館主」專屬角色色彩 |
| 連續打卡 30 天 | 🏅 毅力徽章 + 500 XP |
| 收藏 50 隻寶可夢 | 🏅 收藏家徽章 |
| 對戰勝利 10 場 | 🏅 戰鬥達人徽章 |

**現實獎勵連結**（杜甫可自訂）：
- Lv.10 → 買一包實體 PTCG 卡包
- Lv.25 → 挑一個寶可夢玩具
- Lv.40 → 去寶可夢中心（如果有旅行機會）

---

## 3. 🃏 PTCG 互動設計

### 3.1 每日寶可夢知識推送

每天早上 7:30（TPE）在 `#每日寶可夢` 推送：

```
🌟 今日寶可夢 #025 — 皮卡丘 Pikachu
━━━━━━━━━━━━━━
屬性：⚡ 電
進化：皮丘 → 皮卡丘 → 雷丘
HP：60
招式：電擊 (20) ｜ 十萬伏特 (120)
弱點：🟤 格鬥 ×2
抵抗：🔩 鋼 -30
撤退：⚡×1

💡 冷知識：皮卡丘的尾巴形狀可以分辨性別！
   公的尾巴尖端是平的，母的是心形的。

❓ 今日問題：皮卡丘是第幾世代的寶可夢？
   回答正確 +15 XP！
```

**資料來源**：內建 151 隻（第一世代）起步，逐步擴充。

### 3.2 猜卡遊戲

**觸發**：`!猜卡` 或每日自動一次

**規則**：
1. 無極給出 3 個提示（逐步揭露）
2. 每個提示後可猜一次
3. 計分：第 1 提示猜對 +30 XP、第 2 +20 XP、第 3 +10 XP

**範例**：
```
🔮 猜猜我是誰？

提示 1：我是水屬性的寶可夢
（輸入答案或輸入「下一個提示」）

提示 2：我背上有大砲
（輸入答案或輸入「下一個提示」）

提示 3：我是關都地區的御三家之一
答案：水箭龜！🐢
```

### 3.3 模擬對戰（簡化版文字回合制）

基於 PTCG 規則簡化，適合小朋友：

**簡化規則**：
- 每人 3 隻寶可夢（不是 6 張 Prize）
- 打倒對方 3 隻就贏
- 不用能量卡 → 每回合自動充 1 能量
- 沒有訓練師卡 → 簡化為「使用藥水（+30 HP，每場限 2 次）」

**回合流程**：
```
Ryan 的回合！
━━━━━━━━━━
你的寶可夢：噴火龍 🔥 HP: 80/150
能量：🔥🔥🔥

對手：水箭龜 💧 HP: 120/150

選擇行動：
1️⃣ 攻擊：火焰放射 (70 傷害，需要 🔥🔥)
2️⃣ 攻擊：龍爪 (50 傷害，需要 🔥)
3️⃣ 使用藥水 (+30 HP)
4️⃣ 換寶可夢

輸入數字選擇 →
```

**弱點/抵抗保留**（教育意義）：
- 火 → 草 ×2 傷害
- 水 → 火 ×2 傷害
- 草 → 水 ×2 傷害
- 其他屬性簡化為無加成

**AI 對手**：無極控制，難度隨等級調整：
- Lv.1-10：隨機出招
- Lv.11-20：會選弱點打
- Lv.21+：會換寶可夢、用藥水

### 3.4 卡牌收藏追蹤系統

**獲取方式**：
- 升級送「寶可夢球」→ 用 `!抽卡` 消耗
- 猜卡答對 → 自動收藏該寶可夢
- 對戰勝利 → 隨機獲得對手的一隻

**收藏指令**：
| 指令 | 功能 |
|------|------|
| `!收藏` | 查看所有收藏的寶可夢 |
| `!圖鑑` | 查看收藏完成度（X/151） |
| `!查看 皮卡丘` | 查看特定寶可夢詳細資訊 |
| `!抽卡` | 消耗 1 寶可夢球抽隨機寶可夢 |
| `!夥伴` | 查看/設定夥伴寶可夢 |

**稀有度系統**：
| 稀有度 | 機率 | 標記 |
|--------|------|------|
| Common | 60% | ⚪ |
| Uncommon | 25% | 🟢 |
| Rare | 12% | 🔵 |
| Ultra Rare | 2.5% | 🟣 |
| Secret Rare | 0.5% | 🌟 |

---

## 4. 🔧 實作方案

### 4.1 Discord Bot API 原生能力

| 功能 | API 支援 | 說明 |
|------|----------|------|
| 訊息監聽 & 回覆 | ✅ `on_message` | XP 計算、指令處理 |
| Slash Commands | ✅ | `/打卡`、`/猜卡`、`/對戰` 等 |
| Embed 訊息 | ✅ | 寶可夢卡片、排行榜、成就公告 |
| 角色管理 | ✅ | 等級稱號自動更新 |
| 按鈕 & 選單 | ✅ `Interactions` | 對戰選擇、猜卡互動 |
| 排程訊息 | ❌ 需自建 | 每日推送用 `cron` 或 `APScheduler` |
| 頻道自動建立 | ✅ | 初始化一鍵建頻道 |

### 4.2 自定義腳本需求

```
ryan-growth-bot/
├── bot.py                 # 主程式入口
├── cogs/
│   ├── xp.py              # XP 計算、升級、排行榜
│   ├── daily.py           # 每日打卡、任務生成、推送
│   ├── pokemon_quiz.py    # 猜卡遊戲邏輯
│   ├── battle.py          # 模擬對戰引擎
│   ├── collection.py      # 卡牌收藏系統
│   └── achievements.py    # 成就 & 徽章
├── data/
│   ├── pokemon.json       # 151 隻寶可夢資料
│   ├── daily_tasks.json   # 任務池
│   └── fun_facts.json     # 冷知識庫
├── db/
│   └── ryan.db            # SQLite 資料庫
└── config.py              # 設定檔
```

### 4.3 資料存儲方案：SQLite

選 SQLite 而非 JSON：單檔案、支援查詢、不怕並發寫入衝突。

**核心表結構**：

```sql
-- 使用者（預留多人擴充）
CREATE TABLE users (
    user_id TEXT PRIMARY KEY,
    xp INTEGER DEFAULT 0,
    level INTEGER DEFAULT 1,
    partner_pokemon TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- XP 記錄（可追溯）
CREATE TABLE xp_log (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id TEXT,
    amount INTEGER,
    reason TEXT,        -- 'message', 'checkin', 'quiz', 'battle', 'task'
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 打卡記錄
CREATE TABLE checkins (
    user_id TEXT,
    date TEXT,          -- 'YYYY-MM-DD'
    streak INTEGER,     -- 連續天數
    PRIMARY KEY (user_id, date)
);

-- 寶可夢收藏
CREATE TABLE collection (
    user_id TEXT,
    pokemon_id INTEGER,
    rarity TEXT,
    obtained_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    obtained_via TEXT,   -- 'gacha', 'quiz', 'battle'
    PRIMARY KEY (user_id, pokemon_id)
);

-- 對戰記錄
CREATE TABLE battles (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id TEXT,
    result TEXT,         -- 'win', 'lose'
    opponent_team TEXT,  -- JSON
    user_team TEXT,      -- JSON
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 成就
CREATE TABLE achievements (
    user_id TEXT,
    badge_id TEXT,
    unlocked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (user_id, badge_id)
);
```

### 4.4 部署方案

- **運行環境**：跟無極同機，Python discord.py
- **Bot Token**：獨立 bot 或用無極的 Discord bot 加 cog
- **排程**：`APScheduler` 處理每日推送
- **備份**：SQLite 檔案每日自動備份到 `~/clawd/backups/`

---

## 5. 📅 開發優先順序

| 階段 | 功能 | 預估 |
|------|------|------|
| **Phase 1** | XP 系統 + 打卡 + 頻道建立 | 1-2 天 |
| **Phase 2** | 每日寶可夢 + 猜卡遊戲 | 1-2 天 |
| **Phase 3** | 收藏系統 + 抽卡 | 1 天 |
| **Phase 4** | 模擬對戰 | 2-3 天 |
| **Phase 5** | 成就徽章 + 排行榜 | 1 天 |
| **Phase 6** | 每日/每週任務系統 | 1-2 天 |

**總計**：約 7-11 天可完成 MVP。

---

*設計者：無極 | 日期：2025-07-11*
*為 Ryan 量身打造 🎮📚*
