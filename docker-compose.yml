services:
  openclaw-gateway:
    build:
      context: .
      args:
        - OPENCLAW_INSTALL_BROWSER=1
        - OPENCLAW_DOCKER_APT_PACKAGES=jq curl wget
    image: openclaw-local:latest
    container_name: openclaw-gateway
    restart: unless-stopped
    # init is critical for reaping zombie Chromium processes
    init: true
    env_file: .env
    environment:
      - HOME=/home/node
      - NODE_ENV=production
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN}
      # This fix ensures both root (build) and node (runtime) use the same path
      - PLAYWRIGHT_BROWSERS_PATH=/app/ms-playwright
    volumes:
      - ${OPENCLAW_CONFIG_DIR:-/home/ubuntu/.openclaw}:/home/node/.openclaw
      - ${OPENCLAW_WORKSPACE_DIR:-/home/ubuntu/.openclaw/workspace}:/home/node/.openclaw/workspace
    ports:
      - "127.0.0.1:18789:18789"
    command:
      [
        "node",
        "dist/index.js",
        "gateway",
        "--bind",
        "lan",
        "--port",
        "18789",
        "--allow-unconfigured"
      ]
