version: '3.8'

services:
  gateway:
    image: ${CDOG_IMAGE:-cdog:local}
    environment:
      CDOG_GATEWAY_TOKEN: ${CDOG_GATEWAY_TOKEN}
      CDOG_GATEWAY_BIND: ${CDOG_GATEWAY_BIND:-lan}
    volumes:
      - ${CDOG_CONFIG_DIR}:/home/node/.cdog
      - ${CDOG_WORKSPACE_DIR}:/home/node/.cdog/workspace
    ports:
      - "${CDOG_GATEWAY_PORT:-18789}:18789"
      - "${CDOG_BRIDGE_PORT:-18790}:18790"
    command: [
      "node", "dist/cli/index.js", "gateway", "start",
      "--bind", "${CDOG_GATEWAY_BIND:-lan}",
      "--port", "${CDOG_GATEWAY_PORT:-18789}"
    ]

  bridge:
    image: ${CDOG_IMAGE:-cdog:local}
    environment:
      CDOG_GATEWAY_TOKEN: ${CDOG_GATEWAY_TOKEN}
    volumes:
      - ${CDOG_CONFIG_DIR}:/home/node/.cdog
      - ${CDOG_WORKSPACE_DIR}:/home/node/.cdog/workspace
    command: ["node", "dist/cli/index.js", "bridge", "start"]
