# /dev — Алгоритм разработки

## Роли
- **Влад** — заказчик, одобряет план и результат
- **Клод (я)** — архитектор, надзиратель, тестировщик
- **Claude Code** — исполнитель кода

---

## Алгоритм

### 1. Приём задачи
- Влад описывает что нужно (текст/голосовое)
- Уточняю если неясно (max 1-2 вопроса)

### 2. Исследование проекта
- Читаю ROADMAP.md, progress.md, LEARNINGS.md проекта
- Смотрю текущий код и архитектуру
- Понимаю контекст: что уже есть, что сломать нельзя

### 3. Планирование
- Scope: что именно делаем
- Файлы: какие создаём/меняем
- Архитектура: решения если есть
- Разбивка на шаги
- Показываю Владу (мелкое — скипаю)

### 4. Запуск Claude Code
- Чёткий промпт с контекстом:
  - Что делать (конкретные шаги)
  - Какие файлы смотреть
  - Ограничения и стиль проекта
  - Что НЕ делать
- Запускаю через `exec` с `pty:true` в нужной `workdir`
- `background:true` для длинных задач

### 5. Надзор
- Мониторю через `process:log`
- Корректирую если пошёл не туда
- Слежу за чистотой кода и архитектурой

### 6. Ревью кода
- `git diff` — что изменилось
- Grep на заглушки: `TODO`, `pass`, `NotImplemented`, `placeholder`, `...`
- Соответствие плану
- Нет мусора / лишних изменений

### 7. Функциональное тестирование
**Цель: убедиться что каждая фича РЕАЛЬНО работает, а не заглушка.**

#### Для Telegram ботов:
- E2E тесты через Telethon (userbot отправляет команды боту, проверяет ответы)
- Проверка всех кнопок, хэндлеров, колбэков
- Проверка edge cases (пустой ввод, длинный текст, etc.)

#### Для веб-приложений:
- Playwright/Claude in Chrome — проверка UI в браузере
- Все кнопки кликабельны и делают что нужно
- Формы работают, навигация работает

#### Для API/бэкенда:
- HTTP запросы к эндпоинтам
- Проверка ответов и статусов
- Проверка БД после операций

#### Результат тестов:
- Чеклист: ✅/❌ по каждой фиче
- Если ❌ → возвращаю Claude Code на фикс → перетестирую
- Повторяю пока все ✅

### 8. Обновление документации
**Параллельно с кодом, не после:**

- **ROADMAP.md** — отметить выполненное ✅, обновить прогресс
- **progress.md** — что сделано, какие файлы, дата
- **LEARNINGS.md** — если были ошибки/уроки:
  ```
  ### YYYY-MM-DD: [Фича] - [Тип ошибки]
  **Проблема:** ...
  **Решение:** ...
  **Избегать:** ...
  ```

### 9. Отчёт Владу
- Что сделано
- Результаты тестов (чеклист)
- Что изменилось в файлах
- Если были отклонения от плана — почему
- Коммит с понятным сообщением

---

## Принципы
- **Мелкое** (< 5 мин) — делаю сам без Claude Code
- **Среднее** — Claude Code с моим надзором
- **Крупное** — полный цикл: план → одобрение → код → тесты → доки → отчёт
- Документация обновляется ВМЕСТЕ с кодом, не "потом"
- Тесты проверяют РЕАЛЬНЫЙ функционал, не синтетику
- Каждая фича должна быть проверена до отчёта
- LEARNINGS.md пополняется при каждой ошибке
